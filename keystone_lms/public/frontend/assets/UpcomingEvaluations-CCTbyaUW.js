import{a$ as x,B as D,d as Y,aZ as z,b3 as ne,E,a_ as j,b4 as k,aX as F,bL as w,bM as oe,b6 as re,b7 as W,bN as ue,bO as Z,bP as ee,y as ie,b1 as ce,b2 as de,bQ as ve,bR as me,bS as fe,bT as pe,i as V,bU as be,bV as ge,b8 as B,b5 as _e,b9 as he,b0 as ye,s as G,c as ke,L as xe,o as y,l as H,w as $,b as _,e as M,u as v,N as Ie,a as S,t as h,F as N,r as K,C as te,aj as Me,n as ae,j as q,D as Se,v as De,T as O,z as le,W as Ce,k as A,p as U,f as T,bW as we,bX as Re,bY as $e,h as Ee,G as Pe,bZ as Te,a8 as Fe,au as Ae}from"./index-H4DTv6Le.js";let J=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function X(a){var c,f;let m=(c=a.innerText)!=null?c:"",p=a.cloneNode(!0);if(!(p instanceof HTMLElement))return m;let s=!1;for(let u of p.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))u.remove(),s=!0;let e=s?(f=p.innerText)!=null?f:"":m;return J.test(e)&&(e=e.replace(J,"")),e}function Ve(a){let c=a.getAttribute("aria-label");if(typeof c=="string")return c.trim();let f=a.getAttribute("aria-labelledby");if(f){let m=f.split(" ").map(p=>{let s=document.getElementById(p);if(s){let e=s.getAttribute("aria-label");return typeof e=="string"?e.trim():X(s).trim()}return null}).filter(Boolean);if(m.length>0)return m.join(", ")}return X(a).trim()}function Be(a){let c=D(""),f=D("");return()=>{let m=x(a);if(!m)return"";let p=m.innerText;if(c.value===p)return f.value;let s=Ve(m).trim().toLowerCase();return c.value=p,f.value=s,s}}var Ne=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Ne||{}),Oe=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(Oe||{});function Ye(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let se=Symbol("MenuContext");function L(a){let c=V(se,null);if(c===null){let f=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,L),f}return c}let je=Y({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:c,attrs:f}){let m=D(1),p=D(null),s=D(null),e=D([]),u=D(""),b=D(null),I=D(1);function i(t=n=>n){let n=b.value!==null?e.value[b.value]:null,o=ge(t(e.value.slice()),r=>x(r.dataRef.domRef)),g=n?o.indexOf(n):null;return g===-1&&(g=null),{items:o,activeItemIndex:g}}let l={menuState:m,buttonRef:p,itemsRef:s,items:e,searchQuery:u,activeItemIndex:b,activationTrigger:I,closeMenu:()=>{m.value=1,b.value=null},openMenu:()=>m.value=0,goToItem(t,n,o){let g=i(),r=pe(t===w.Specific?{focus:w.Specific,id:n}:{focus:t},{resolveItems:()=>g.items,resolveActiveIndex:()=>g.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.disabled});u.value="",b.value=r,I.value=o??1,e.value=g.items},search(t){let n=u.value!==""?0:1;u.value+=t.toLowerCase();let o=(b.value!==null?e.value.slice(b.value+n).concat(e.value.slice(0,b.value+n)):e.value).find(r=>r.dataRef.textValue.startsWith(u.value)&&!r.dataRef.disabled),g=o?e.value.indexOf(o):-1;g===-1||g===b.value||(b.value=g,I.value=1)},clearSearch(){u.value=""},registerItem(t,n){let o=i(g=>[...g,{id:t,dataRef:n}]);e.value=o.items,b.value=o.activeItemIndex,I.value=1},unregisterItem(t){let n=i(o=>{let g=o.findIndex(r=>r.id===t);return g!==-1&&o.splice(g,1),o});e.value=n.items,b.value=n.activeItemIndex,I.value=1}};return ve([p,s],(t,n)=>{var o;l.closeMenu(),me(n,fe.Loose)||(t.preventDefault(),(o=x(p))==null||o.focus())},E(()=>m.value===0)),_e(se,l),he(E(()=>ye(m.value,{0:B.Open,1:B.Closed}))),()=>{let t={open:m.value===0,close:l.closeMenu};return j({ourProps:{},theirProps:a,slot:t,slots:c,attrs:f,name:"Menu"})}}}),Le=Y({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(a,{attrs:c,slots:f,expose:m}){var p;let s=(p=a.id)!=null?p:`headlessui-menu-button-${z()}`,e=L("MenuButton");m({el:e.buttonRef,$el:e.buttonRef});function u(l){switch(l.key){case k.Space:case k.Enter:case k.ArrowDown:l.preventDefault(),l.stopPropagation(),e.openMenu(),F(()=>{var t;(t=x(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(w.First)});break;case k.ArrowUp:l.preventDefault(),l.stopPropagation(),e.openMenu(),F(()=>{var t;(t=x(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(w.Last)});break}}function b(l){switch(l.key){case k.Space:l.preventDefault();break}}function I(l){a.disabled||(e.menuState.value===0?(e.closeMenu(),F(()=>{var t;return(t=x(e.buttonRef))==null?void 0:t.focus({preventScroll:!0})})):(l.preventDefault(),e.openMenu(),Ye(()=>{var t;return(t=x(e.itemsRef))==null?void 0:t.focus({preventScroll:!0})})))}let i=ne(E(()=>({as:a.as,type:c.type})),e.buttonRef);return()=>{var l;let t={open:e.menuState.value===0},{...n}=a,o={ref:e.buttonRef,id:s,type:i.value,"aria-haspopup":"menu","aria-controls":(l=x(e.itemsRef))==null?void 0:l.id,"aria-expanded":e.menuState.value===0,onKeydown:u,onKeyup:b,onClick:I};return j({ourProps:o,theirProps:n,slot:t,attrs:c,slots:f,name:"MenuButton"})}}}),Ue=Y({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(a,{attrs:c,slots:f,expose:m}){var p;let s=(p=a.id)!=null?p:`headlessui-menu-items-${z()}`,e=L("MenuItems"),u=D(null);m({el:e.itemsRef,$el:e.itemsRef}),oe({container:E(()=>x(e.itemsRef)),enabled:E(()=>e.menuState.value===0),accept(t){return t.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:t.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(t){t.setAttribute("role","none")}});function b(t){var n;switch(u.value&&clearTimeout(u.value),t.key){case k.Space:if(e.searchQuery.value!=="")return t.preventDefault(),t.stopPropagation(),e.search(t.key);case k.Enter:if(t.preventDefault(),t.stopPropagation(),e.activeItemIndex.value!==null){let o=e.items.value[e.activeItemIndex.value];(n=x(o.dataRef.domRef))==null||n.click()}e.closeMenu(),ee(x(e.buttonRef));break;case k.ArrowDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(w.Next);case k.ArrowUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(w.Previous);case k.Home:case k.PageUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(w.First);case k.End:case k.PageDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(w.Last);case k.Escape:t.preventDefault(),t.stopPropagation(),e.closeMenu(),F(()=>{var o;return(o=x(e.buttonRef))==null?void 0:o.focus({preventScroll:!0})});break;case k.Tab:t.preventDefault(),t.stopPropagation(),e.closeMenu(),F(()=>ue(x(e.buttonRef),t.shiftKey?Z.Previous:Z.Next));break;default:t.key.length===1&&(e.search(t.key),u.value=setTimeout(()=>e.clearSearch(),350));break}}function I(t){switch(t.key){case k.Space:t.preventDefault();break}}let i=re(),l=E(()=>i!==null?(i.value&B.Open)===B.Open:e.menuState.value===0);return()=>{var t,n;let o={open:e.menuState.value===0},{...g}=a,r={"aria-activedescendant":e.activeItemIndex.value===null||(t=e.items.value[e.activeItemIndex.value])==null?void 0:t.id,"aria-labelledby":(n=x(e.buttonRef))==null?void 0:n.id,id:s,onKeydown:b,onKeyup:I,role:"menu",tabIndex:0,ref:e.itemsRef};return j({ourProps:r,theirProps:g,slot:o,attrs:c,slots:f,features:W.RenderStrategy|W.Static,visible:l.value,name:"MenuItems"})}}}),He=Y({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(a,{slots:c,attrs:f,expose:m}){var p;let s=(p=a.id)!=null?p:`headlessui-menu-item-${z()}`,e=L("MenuItem"),u=D(null);m({el:u,$el:u});let b=E(()=>e.activeItemIndex.value!==null?e.items.value[e.activeItemIndex.value].id===s:!1),I=Be(u),i=E(()=>({disabled:a.disabled,get textValue(){return I()},domRef:u}));ie(()=>e.registerItem(s,i)),ce(()=>e.unregisterItem(s)),de(()=>{e.menuState.value===0&&b.value&&e.activationTrigger.value!==0&&F(()=>{var d,R;return(R=(d=x(u))==null?void 0:d.scrollIntoView)==null?void 0:R.call(d,{block:"nearest"})})});function l(d){if(a.disabled)return d.preventDefault();e.closeMenu(),ee(x(e.buttonRef))}function t(){if(a.disabled)return e.goToItem(w.Nothing);e.goToItem(w.Specific,s)}let n=be();function o(d){n.update(d)}function g(d){n.wasMoved(d)&&(a.disabled||b.value||e.goToItem(w.Specific,s,0))}function r(d){n.wasMoved(d)&&(a.disabled||b.value&&e.goToItem(w.Nothing))}return()=>{let{disabled:d,...R}=a,P={active:b.value,disabled:d,close:e.closeMenu};return j({ourProps:{id:s,ref:u,role:"menuitem",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,onClick:l,onFocus:t,onPointerenter:o,onMouseenter:o,onPointermove:g,onMousemove:g,onPointerleave:r,onMouseleave:r},theirProps:{...f,...R},slot:P,attrs:f,slots:c,name:"MenuItem"})}}});const Ke={class:"flex flex-col gap-4 text-base max-h-[60vh]"},qe={key:0,class:"space-y-4 overflow-y-auto mt-4"},ze={class:"text-ink-gray-9 font-medium"},Qe={class:"space-y-5"},We={class:"space-y-2"},Ze={class:"flex items-center text-ink-gray-7 space-x-2"},Ge={class:"text-ink-gray-9"},Je={class:"text-ink-gray-5"},Xe={class:"grid grid-cols-3 gap-2"},et=["onClick"],tt={key:1,class:"text-ink-red-3"},at={__name:"EvaluationModal",props:De({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(a){const c=V("$user"),f=G(a,"modelValue"),m=G(a,"reloadEvals"),p=a,s=D({course:"",date:"",start_time:"",end_time:"",day:"",batch:p.batch,member:c.data.name});function e(i){if(!s.value.date||!s.value.start_time){O.warning(__("Please select a slot for your evaluation."),{duration:10});return}le("frappe.client.insert",{doc:{doctype:"LMS Certificate Request",batch_name:s.value.batch,...s.value}}).then(()=>{m.value.reload(),i()}).catch(l=>{var t,n;console.log(((t=l.messages)==null?void 0:t[0])||l),O.warning(__(((n=l.messages)==null?void 0:n[0])||l),{duration:20})})}const u=()=>{const i=[];for(const l of p.courses)l.evaluator&&i.push({label:l.title,value:l.course});return i.length===1&&(s.value.course=i[0].value),i},b=ke({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(i){return{course:i.course,batch:p.batch}}});xe(()=>s.value.course,i=>{b.reload(s.value)});const I=(i,l)=>{s.value.start_time=i.start_time,s.value.end_time=i.end_time,s.value.date=l.date,s.value.day=l.day};return(i,l)=>(y(),H(v(Se),{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=t=>f.value=t),options:{title:i.__("Schedule your evaluation"),size:"xl",actions:[{label:i.__("Submit"),variant:"solid",onClick:t=>e(t)}]}},{"body-content":$(()=>{var t;return[_("div",Ke,[M(v(Ie),{modelValue:s.value.course,"onUpdate:modelValue":l[0]||(l[0]=n=>s.value.course=n),type:"select",label:i.__("Course"),options:u()},null,8,["modelValue","label","options"]),(t=v(b).data)!=null&&t.length?(y(),S("div",qe,[_("div",ze,h(i.__("Available Slots")),1),_("div",Qe,[(y(!0),S(N,null,K(v(b).data,n=>(y(),S("div",We,[_("div",Ze,[M(v(te),{class:"size-3"}),_("div",Ge,h(v(Me)(n.date).format("DD MMMM YYYY")),1),l[2]||(l[2]=_("div",null,"Â·",-1)),_("div",Je,h(n.day),1)]),_("div",Xe,[(y(!0),S(N,null,K(n.slots,o=>(y(),S("div",{class:ae(["text-base text-center border rounded-md text-ink-gray-8 p-2 cursor-pointer text-ink-gray-7 hover:bg-surface-gray-2 hover:border-outline-gray-3",{"border-outline-gray-4 text-ink-gray-9":s.value.date==n.date&&s.value.start_time==o.start_time}]),onClick:g=>I(o,n)},h(v(q)(o.start_time))+" - "+h(v(q)(o.end_time)),11,et))),256))])]))),256))])])):(y(),S("div",tt,h(i.__("No slots available for the selected course.")),1))])]}),_:1},8,["modelValue","options"]))}},lt={key:0},st={class:"flex items-center justify-between mb-4"},nt={class:"text-lg text-ink-gray-9 font-semibold"},ot={key:0,class:"text-sm leading-5 bg-surface-amber-1 text-ink-amber-3 p-2 rounded-md mb-4"},rt={class:"font-medium"},ut={key:1,class:"text-sm leading-5 bg-surface-red-1 text-ink-red-3 p-2 rounded-md mb-4"},it={key:2},ct={class:"border text-ink-gray-7 rounded-md p-3"},dt={class:"flex justify-between mb-3"},vt={class:"text-lg font-semibold text-ink-gray-9 leading-5"},mt={class:"flex items-center mb-2"},ft={class:"ml-2"},pt={class:"flex items-center mb-2"},bt={class:"ml-2"},gt={class:"flex items-center"},_t={class:"ml-2"},ht={key:0,class:"flex items-center justify-between space-x-2 mt-4"},yt={key:3,class:"text-ink-gray-5"},It={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null},forHome:{type:Boolean,default:!1}},setup(a){var o,g;const c=V("$dayjs"),f=V("$user"),m=D(!1),p=Ae(),{$dialog:s}=p.appContext.config.globalProperties,e=a,u=Ce({doctype:"LMS Certificate Request",filters:{course:(o=e.courses)!=null&&o.length?["in",e.courses.map(r=>r.course)]:void 0,batch_name:e.batch||void 0,status:"Upcoming",member:(g=f==null?void 0:f.data)==null?void 0:g.name,date:[">=",c().format("YYYY-MM-DD")]},fields:["name","date","start_time","evaluator_name","course_title","member","google_meet_link"],orderBy:"date",auto:!0});function b(){m.value=!0}const I=r=>{window.open(r.google_meet_link,"_blank")},i=E(()=>e.courses.filter(r=>r.evaluator!="")),l=E(()=>{var r,d;return((r=u.data)==null?void 0:r.length)!=((d=i.value)==null?void 0:d.length)&&!e.forHome&&!t.value}),t=E(()=>c().isSameOrAfter(c(e.endDate))),n=r=>{s({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(d){le("lms.lms.api.cancel_evaluation",{evaluation:r}).then(()=>{u.reload(),O.success(__("Evaluation cancelled successfully"))}).catch(R=>{var P;O.error(__(((P=R.messages)==null?void 0:P[0])||R)),console.error(R)}),d()}}]})};return(r,d)=>{var R,P;return y(),S(N,null,[!a.forHome||a.forHome&&((R=v(u).data)!=null&&R.length)?(y(),S("div",lt,[_("div",st,[_("div",nt,h(r.__("Upcoming Evaluations")),1),l.value?(y(),H(v(U),{key:0,onClick:b},{default:$(()=>[A(h(r.__("Schedule Evaluation")),1)]),_:1})):T("",!0)]),a.endDate&&!t.value?(y(),S("div",ot,[A(h(r.__("The last day to schedule your evaluations is "))+" ",1),_("span",rt,h(v(c)(a.endDate).format("DD MMMM YYYY")),1),A(". "+h(r.__("Please make sure to schedule your evaluation before this date.")),1)])):t.value?(y(),S("div",ut,h(r.__("The deadline to schedule evaluations has passed. Please contact the Instructor for assistance.")),1)):T("",!0),(P=v(u).data)!=null&&P.length?(y(),S("div",it,[_("div",{class:ae(["grid gap-4",a.forHome?"grid-cols-1 md:grid-cols-2":"grid-cols-3"])},[(y(!0),S(N,null,K(v(u).data,C=>(y(),S("div",null,[_("div",ct,[_("div",dt,[_("span",vt,h(C.course_title),1),C.date>v(c)().format()?(y(),H(v(je),{key:0,as:"div",class:"relative inline-block text-left"},{default:$(()=>[_("div",null,[M(v(Le),{class:"inline-flex w-full justify-center"},{default:$(()=>[M(v(we),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),M(Re,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:$(()=>[M(v(Ue),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:$(()=>[M(v(He),null,{default:$(({active:Q})=>[M(v(U),{variant:"ghost",class:"w-full",onClick:kt=>n(C)},{prefix:$(()=>[M(v($e),{active:Q,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:$(()=>[A(" "+h(r.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):T("",!0)]),_("div",mt,[M(v(te),{class:"w-4 h-4 stroke-1.5"}),_("span",ft,h(v(c)(C.date).format("DD MMMM YYYY")),1)]),_("div",pt,[M(v(Ee),{class:"w-4 h-4 stroke-1.5"}),_("span",bt,h(v(q)(C.start_time)),1)]),_("div",gt,[M(v(Pe),{class:"w-4 h-4 stroke-1.5"}),_("span",_t,h(C.evaluator_name),1)]),C.google_meet_link?(y(),S("div",ht,[M(v(U),{onClick:Q=>I(C),class:"w-full"},{prefix:$(()=>[M(v(Te),{class:"w-4 h-4 stroke-1.5"})]),default:$(()=>[A(" "+h(r.__("Join Call")),1)]),_:1},8,["onClick"])])):T("",!0)])]))),256))],2)])):t.value?T("",!0):(y(),S("div",yt,h(r.__("Schedule an evaluation to get certified.")),1))])):T("",!0),M(at,{batch:a.batch,endDate:a.endDate,courses:a.courses,modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=C=>m.value=C),reloadEvals:v(u),"onUpdate:reloadEvals":d[1]||(d[1]=C=>Fe(u)?u.value=C:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{It as _};
//# sourceMappingURL=UpcomingEvaluations-CCTbyaUW.js.map
