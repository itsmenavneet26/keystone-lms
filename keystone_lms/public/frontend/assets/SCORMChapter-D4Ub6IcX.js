import{x as V,aP as D,bk as B,as as F,W as I,c as y,A as z,o as p,a as _,b as l,e as M,u as c,t as N,w as A,k as O,p as j,f as q,F as W,i as Y,B as w,E as H,z as J}from"./index-H4DTv6Le.js";import{_ as K}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";const Q={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},U={key:0},X=["src"],Z={key:1},k={class:"text-center pt-10 px-5 md:px-0 pb-10"},ee={class:"text-center"},te={class:"mb-4"},se=!1,ce={__name:"SCORMChapter",props:{courseName:{type:String,required:!0},chapterName:{type:String,required:!0}},setup(E){var v,C;const{brand:T}=V(),x=D(),n=Y("$user"),S=w(!1),m=w(!1),r=E;B(()=>{x.isSidebarCollapsed=!0,$()});const o=F({doctype:"Course Chapter",name:r.chapterName,auto:!0,cache:["chapter",r.chapterName],onSuccess(e){u.submit()}}),d=I({doctype:"LMS Enrollment",fields:["member","course"],filters:{course:r.courseName,member:(v=n.data)==null?void 0:v.name},auto:!0,cache:["enrollments",r.courseName,(C=n.data)==null?void 0:C.name]}),f=e=>{var t,s,a;return e==="cmi.core.lesson_status"?((t=u.data)==null?void 0:t.status)==="Complete"?"passed":"incomplete":e==="cmi.launch_data"?((s=u.data)==null?void 0:s.scorm_content)||"":e==="cmi.suspend_data"&&((a=u.data)==null?void 0:a.scorm_content)||""};let h=null;const G=e=>{clearTimeout(h),h=setTimeout(()=>{g(e)},300)},b=(e,t)=>{const s=e==="cmi.core.lesson_status"&&t==="passed",a=e==="cmi.completion_status"&&t==="completed",i=e==="cmi.core.lesson_status"&&t==="failed"||e==="cmi.completion_status"&&t==="incomplete";if((s||a)&&(m.value=!0),s||a||i&&se){g({is_complete:m.value,scorm_content:""});return}e==="cmi.suspend_data"&&!m.value&&G({is_complete:!1,scorm_content:t})},g=(e=null)=>{J("lms.lms.doctype.course_lesson.course_lesson.save_progress",{lesson:o.doc.lessons[0].lesson,course:r.courseName,scorm_details:e})},u=y({url:"frappe.client.get_value",makeParams(e){var t,s;return{doctype:"LMS Course Progress",fieldname:["status","scorm_content"],filters:{member:(t=n.data)==null?void 0:t.name,lesson:o.doc.lessons[0].lesson,chapter:o.doc.name,course:(s=o.doc)==null?void 0:s.course}}},onSuccess(e){S.value=!0}}),P=()=>{var e;d.insert.submit({course:r.courseName,member:(e=n.data)==null?void 0:e.name},{onSuccess(t){window.location.reload()}})},$=()=>{window.API_1484_11={Initialize:()=>"true",Terminate:()=>"true",GetValue:e=>(console.log(`GET: ${e}`),f(e)),SetValue:(e,t)=>(console.log(`SET: ${e} to value: ${t}`),b(e,t),"true"),Commit:()=>"true",GetLastError:()=>"0",GetErrorString:()=>"",GetDiagnostic:()=>""},window.API={LMSInitialize:()=>"true",LMSFinish:()=>"true",LMSGetValue:e=>(console.log(`GET: ${e}`),f(e)),LMSSetValue:(e,t)=>(console.log(`SET: ${e} to value: ${t}`),b(e,t),"true"),LMSCommit:()=>"true",LMSGetLastError:()=>"0",LMSGetErrorString:()=>"",LMSGetDiagnostic:()=>""}},R=H(()=>{var e,t;return[{label:__("Courses"),route:{name:"Courses"}},{label:(e=o.doc)==null?void 0:e.course_title,route:{name:"CourseDetail",params:{courseName:r.courseName}}},{label:(t=o.doc)==null?void 0:t.title}]});return z(()=>{var e;return{title:(e=o.doc)==null?void 0:e.title,icon:T.favicon}}),(e,t)=>{var s,a,i,L;return p(),_(W,null,[l("header",Q,[M(c(K),{class:"h-7",items:R.value},null,8,["items"])]),S.value&&((s=c(d).data)!=null&&s.length||(a=c(n).data)!=null&&a.is_moderator||(i=c(n).data)!=null&&i.is_instructor)?(p(),_("div",U,[l("iframe",{src:c(o).doc.launch_file,class:"w-full h-[calc(100vh-3.00rem)]"},null,8,X)])):(L=c(d).data)!=null&&L.length?q("",!0):(p(),_("div",Z,[l("div",k,[l("div",ee,[l("div",te,N(e.__("You are not enrolled in this course. Please enroll to access this lesson.")),1),M(c(j),{variant:"solid",onClick:t[0]||(t[0]=oe=>P())},{default:A(()=>[O(N(e.__("Start Learning")),1)]),_:1})])])]))],64)}}};export{ce as default};
//# sourceMappingURL=SCORMChapter-D4Ub6IcX.js.map
