import{q as re,i as K,y as Y,K as le,c as T,as as ue,T as D,L as B,z as de,u as a,o as r,a as m,b as n,t as o,f as v,n as G,l as k,w as S,k as L,a2 as j,e as y,p as O,bb as me,bc as ce,aq as be,N as z,S as H,B as A,E as x,x as fe,A as pe,F as ge}from"./index-H4DTv6Le.js";import{_ as ve}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";const _e={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},ye={key:0},he={key:1},we={class:"text-sm text-ink-gray-7 font-medium mb-2"},ke=["innerHTML"],Se={class:"flex flex-col overflow-y-auto"},xe={class:"p-5 space-y-5"},Ne={class:"flex items-center justify-between"},De={class:"font-semibold text-ink-gray-9"},Le={class:"flex items-center space-x-2"},Ae={key:0,class:"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm"},Te={key:1,class:"border rounded-lg p-3"},Ie={class:"font-semibold mb-2"},Ce={class:"text-ink-gray-5 text-sm mt-1 mb-4"},Fe={key:1},Me={class:"flex items-center text-ink-gray-7"},Re=["href"],Pe={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Ue={key:2},Ve={class:"text-xs text-ink-gray-5 mb-1"},Ee={key:3},qe={class:"text-sm mb-2 text-ink-gray-7"},Be={key:4,class:"mt-8 p-3 border rounded-lg"},Ge={class:"text-ink-gray-5 mb-4"},je=["innerHTML"],Oe={key:5,class:"mt-8 space-y-4"},ze={class:"font-semibold mb-2 text-ink-gray-9"},He={class:"text-sm text-ink-gray-5 mb-1"},Ke={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"},showTitle:{type:Boolean,default:!0}},setup(p){var F;const g=A(null),_=A(null),c=re(),u=K("$user"),d=A(!1),b=p;Y(()=>{window.addEventListener("keydown",h)});const h=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(I(),e.preventDefault())};le(()=>{window.removeEventListener("keydown",h)});const f=T({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:b.assignmentID},auto:!0,onSuccess(e){b.submissionName!="new"&&t.reload()}}),Q=T({url:"frappe.client.insert",makeParams(e){var i;let s={doctype:"LMS Assignment Submission",assignment:b.assignmentID,member:(i=u.data)==null?void 0:i.name};return N()||(s.answer=g.value),{doc:s}}}),t=ue({doctype:"LMS Assignment Submission",name:b.submissionName,onError(e){var s;D.error(((s=e.messages)==null?void 0:s[0])||e)},auto:!1,cache:[(F=u.data)==null?void 0:F.name,b.assignmentID]});B(t,()=>{t.doc&&(t.doc.answer&&(g.value=t.doc.answer),t.doc.comments&&(_.value=t.doc.comments),t.isDirty||N()&&!t.doc.assignment_attachment||!N()&&!g.value?d.value=!0:d.value=!1)}),B(()=>t.doc,()=>{var e;b.submissionName=="new"&&((e=t.doc)!=null&&e.assignment_attachment)&&(d.value=!0)});const I=()=>{var e,s;if(b.submissionName!="new"){let i=t.doc&&t.doc.owner!=((e=u.data)==null?void 0:e.name)?(s=u.data)==null?void 0:s.name:null;t.setValue.submit({...t.doc,evaluator:i,comments:_.value,answer:g.value},{onSuccess(w){d.value=!1,D.success(__("Changes saved successfully"))}})}else W()},W=()=>{Q.submit({},{onSuccess(e){D.success(__("Assignment submitted successfully")),c.currentRoute.value.name=="AssignmentSubmission"?c.push({name:"AssignmentSubmission",params:{assignmentID:b.assignmentID,submissionName:e.name},query:{fromLesson:c.currentRoute.value.query.fromLesson}}):(J(),c.go()),t.name=e.name,t.reload()},onError(e){var s;D.error(((s=e.messages)==null?void 0:s[0])||e)}})},X=e=>{d.value=!0,t.doc.assignment_attachment=e.file_url},J=()=>{if(c.currentRoute.value.name=="Lesson"){let e=c.currentRoute.value.params.courseName,s=c.currentRoute.value.params.chapterNumber,i=c.currentRoute.value.params.lessonNumber;de("lms.lms.api.mark_lesson_progress",{course:e,chapter_number:s,lesson_number:i})}},Z=()=>{var s;const e=(s=f.data)==null?void 0:s.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},ee=e=>{var w;let s=(w=f.data)==null?void 0:w.type,i=e.name.split(".").pop().toLowerCase();if(s=="Image"&&!["jpg","jpeg","png"].includes(i))return"Only image file is allowed.";if(s=="Document"&&!["doc","docx","xml"].includes(i))return"Only document file is allowed.";if(s=="PDF"&&!["pdf"].includes(i))return"Only PDF file is allowed."},se=()=>{d.value=!0,t.doc.assignment_attachment=""},te=x(()=>{var e,s,i;return(((e=u.data)==null?void 0:e.is_moderator)||((s=u.data)==null?void 0:s.is_evaluator)||((i=u.data)==null?void 0:i.is_instructor))&&b.submissionName!="new"&&c.currentRoute.value.name=="AssignmentSubmission"}),C=x(()=>{var e,s,i;return!t.doc||((e=t.doc)==null?void 0:e.owner)==((s=u.data)==null?void 0:s.name)&&((i=t.doc)==null?void 0:i.status)=="Not Graded"}),ae=x(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),ne=x(()=>t.doc?t.doc.status=="Pass"?"green":t.doc.status=="Not Graded"?"blue":"red":"orange"),N=()=>{var e;return["PDF","Image","Document"].includes((e=f.data)==null?void 0:e.type)};return(e,s)=>{var i,w,M,R,P,$,U,V,E,q;return a(f).data?(r(),m("div",{key:0,class:G(["grid grid-cols-2 h-full",{"border rounded-lg overflow-auto":!p.showTitle}])},[n("div",{class:G(["border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]",{"h-full":!p.showTitle}])},[p.showTitle?(r(),m("div",_e,[p.submissionName==="new"?(r(),m("div",ye,o(e.__("Submission by"))+" "+o((i=a(u).data)==null?void 0:i.full_name),1)):(r(),m("div",he,o(e.__("Submission by"))+" "+o((w=a(t).doc)==null?void 0:w.member_name),1))])):v("",!0),n("div",we,o(e.__("Question"))+": ",1),n("div",{innerHTML:a(f).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,ke)],2),n("div",Se,[n("div",xe,[n("div",Ne,[n("div",De,o(e.__("Submission")),1),n("div",Le,[d.value?(r(),k(a(j),{key:0,theme:"orange"},{default:S(()=>[L(o(e.__("Not Saved")),1)]),_:1})):(M=a(t).doc)!=null&&M.status?(r(),k(a(j),{key:1,theme:ne.value,size:"lg"},{default:S(()=>{var l;return[L(o((l=a(t).doc)==null?void 0:l.status),1)]}),_:1},8,["theme"])):v("",!0),y(a(O),{variant:"solid",onClick:s[0]||(s[0]=l=>I())},{default:S(()=>[L(o(e.__("Save")),1)]),_:1})])]),p.submissionName!="new"&&!["Pass","Fail"].includes((R=a(t).doc)==null?void 0:R.status)&&((P=a(t).doc)==null?void 0:P.owner)==(($=a(u).data)==null?void 0:$.name)?(r(),m("div",Ae,o(e.__("You've successfully submitted the assignment."))+" "+o(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+o(e.__("Feel free to make edits to your submission if needed.")),1)):v("",!0),N()?(r(),m("div",Te,[n("div",Ie,o(e.__("Upload Assignment")),1),n("div",Ce,o(e.__("You can only upload {0} files").format(a(f).data.type)),1),(U=a(t).doc)!=null&&U.assignment_attachment?(r(),m("div",Fe,[n("div",Me,[n("a",{href:a(t).doc.assignment_attachment,target:"_blank",class:"cursor-pointer !no-underline text-sm leading-5"},[n("div",Pe,[n("div",$e,[y(a(ce),{class:"h-5 w-5 stroke-1.5"})]),n("span",null,o(a(t).doc.assignment_attachment.split("/").pop()),1)])],8,Re),C.value?(r(),k(a(be),{key:0,onClick:s[2]||(s[2]=l=>se()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):v("",!0)])])):(r(),k(a(me),{key:0,fileTypes:Z(),uploadArgs:{private:!0},validateFile:ee,onSuccess:s[1]||(s[1]=l=>X(l))},{default:S(({uploading:l,progress:oe,openFileSelector:ie})=>[y(a(O),{onClick:ie,loading:l},{default:S(()=>[L(o(l?e.__("Uploading {0}%").format(oe):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(f).data.type=="URL"?(r(),m("div",Ue,[n("div",Ve,o(e.__("Enter a URL")),1),y(a(z),{modelValue:g.value,"onUpdate:modelValue":s[3]||(s[3]=l=>g.value=l),type:"text",readonly:!C.value},null,8,["modelValue","readonly"])])):(r(),m("div",Ee,[n("div",qe,o(e.__("Write your answer here")),1),y(a(H),{content:g.value,onChange:s[4]||(s[4]=l=>g.value=l),editable:!0,fixedMenu:!0,uploadArgs:{private:!0},editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((V=a(u).data)==null?void 0:V.name)==((E=a(t).doc)==null?void 0:E.owner)&&((q=a(t).doc)!=null&&q.comments)?(r(),m("div",Be,[n("div",Ge,o(e.__("Comments by Evaluator")),1),n("div",{class:"leading-6 text-ink-gray-9",innerHTML:a(t).doc.comments},null,8,je)])):v("",!0),te.value?(r(),m("div",Oe,[n("div",ze,o(e.__("Grading")),1),a(t).doc?(r(),k(a(z),{key:0,modelValue:a(t).doc.status,"onUpdate:modelValue":s[5]||(s[5]=l=>a(t).doc.status=l),label:e.__("Grade"),type:"select",options:ae.value},null,8,["modelValue","label","options"])):v("",!0),n("div",null,[n("div",He,o(e.__("Comments")),1),y(a(H),{content:_.value,onChange:s[6]||(s[6]=l=>{_.value=l,d.value=!0}),editable:!0,fixedMenu:!0,uploadArgs:{private:!0},editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):v("",!0)])])],2)):v("",!0)}}},Ye={key:0,class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Qe={class:"overflow-hidden h-[calc(100vh-3.2rem)]"},Je={__name:"AssignmentSubmission",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(p){const g=K("$user"),_=A(!1),{brand:c}=fe(),u=p,d=T({url:"frappe.client.get_value",params:{doctype:"LMS Assignment",fieldname:"title",filters:{name:u.assignmentID}},auto:!0});Y(()=>{g.data||(window.location.href="/login"),new URLSearchParams(window.location.search).get("fromLesson")&&(_.value=!0)});const b=x(()=>{var f;return[{label:__("Submissions"),route:{name:"AssignmentSubmissionList"}},{label:(f=d.data)==null?void 0:f.title,route:{name:"AssignmentSubmission",params:{assignmentID:u.assignmentID}}}]});return pe(()=>{var h;return{title:(h=d.data)==null?void 0:h.title,icon:c.favicon}}),(h,f)=>(r(),m(ge,null,[_.value?v("",!0):(r(),m("header",Ye,[y(a(ve),{items:b.value},null,8,["items"])])),n("div",Qe,[y(Ke,{assignmentID:p.assignmentID,submissionName:p.submissionName,showTitle:!_.value},null,8,["assignmentID","submissionName","showTitle"])])],64))}};export{Je as default};
//# sourceMappingURL=AssignmentSubmission-BZRex_Gf.js.map
