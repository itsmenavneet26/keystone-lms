import{x as H,y as Y,W as M,c as L,b1 as P,A as q,o as a,a as n,b as s,e as r,u as i,l as B,w as S,k as E,t as c,p as T,f as d,F as h,r as j,n as F,ab as R,aj as z,aq as I,bf as O,C as W,h as X,j as G,i as D,q as J,E as U,B as K}from"./index-H4DTv6Le.js";import{_ as Q}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";import{T as Z}from"./TabButtons-BM55rf33.js";const ee={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},te={class:"flex items-center space-x-2"},se={class:"w-full md:w-3/4 mx-auto px-5 pt-6 divide-y"},ae=["onClick"],ie={class:"space-y-2 w-full"},ne={class:"flex items-center justify-between"},oe={class:"flex items-center"},ce=["innerHTML"],re={class:"flex items-center space-x-2"},de={class:"text-sm text-ink-gray-5"},le=["innerHTML"],ue={key:1,class:"flex items-stretch border border-outline-gray-2 space-x-2 rounded-md"},me=["src"],_e=["src"],fe={class:"p-3"},pe={class:"bg-surface-violet-1 w-fit py-1 px-1.5 rounded-full text-ink-violet-1 text-sm mb-2"},he={class:"font-semibold mb-1"},ke={class:"leading-5"},be={key:0,class:"flex items-center space-x-2 text-sm mt-5"},ve={key:1,class:"flex items-center space-x-2 text-sm mt-2"},ye={key:2,class:"space-y-2 mt-5"},xe={class:"flex items-center space-x-2"},we={class:"font-medium text-sm"},Ne={key:1,class:"text-ink-gray-5"},Se={__name:"Notifications",setup(Ce){const{brand:V}=H(),f=D("$user"),k=D("$socket"),_=K("Unread"),l=J();Y(()=>{f.data||l.push({name:"Courses"}),k.on("publish_lms_notifications",t=>{u.reload()})});const b=U(()=>_.value==="Unread"?u.data:p.data),u=M({doctype:"Notification Log",url:"lms.lms.api.get_notifications",filters:{read:0},auto:!!f.data,cache:"Unread Notifications"}),p=M({doctype:"Notification Log",url:"lms.lms.api.get_notifications",filters:{read:1},auto:!!f.data,cache:"Read Notifications"}),$=L({url:"frappe.desk.doctype.notification_log.notification_log.mark_as_read",makeParams(t){return{docname:t.name}},onSuccess(t){u.reload(),p.reload()}}),v=L({url:"frappe.desk.doctype.notification_log.notification_log.mark_all_as_read",onSuccess(t){u.reload(),p.reload()}}),y=t=>{$.submit({name:t})},g=t=>{if(!t.link)return;y(t.name);let o=t.link.split("/");o[2]=="courses"?l.push({name:"CourseDetail",params:{courseName:o[3]}}):o.includes("batches")?o.includes("details")?l.push({name:"BatchDetail",params:{batchName:o.pop()}}):l.push({name:"Batch",params:{batchName:o.pop()}}):o.includes("assignment-submission")&&l.push({name:"AssignmentSubmission",params:{submissionName:o[4],assignmentID:o[3]}})},x=t=>!!(t.type=="Mention"||t.subject.includes("mentioned you")||t.subject.includes("comment")),w=t=>["LMS Course","LMS Batch"].includes(t.document_type)&&t.document_details;P(()=>{k.off("publish_lms_notifications")});const A=U(()=>[{label:"Notifications",route:{name:"Notifications"}}]);return q(()=>({title:"Notifications",icon:V.favicon})),(t,o)=>{var N,C;return a(),n(h,null,[s("header",ee,[r(i(Q),{items:A.value},null,8,["items"]),s("div",te,[_.value==="Unread"&&((N=i(u).data)==null?void 0:N.length)>0?(a(),B(i(T),{key:0,onClick:i(v).submit,loading:i(v).loading},{default:S(()=>[E(c(t.__("Mark all as read")),1)]),_:1},8,["onClick","loading"])):d("",!0),r(i(Z),{class:"inline-block",buttons:[{label:"Unread",active:!0},{label:"Read"}],modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=e=>_.value=e)},null,8,["modelValue"])])]),s("div",se,[(C=b.value)!=null&&C.length?(a(!0),n(h,{key:0},j(b.value,e=>(a(),n("div",{key:e.name,class:F(["flex space-x-2 px-2 py-4",{"cursor-pointer":e.link,"items-center":!w(e)&&!x(e)}]),onClick:m=>g(e)},[r(i(R),{image:e.from_user_details.user_image,size:"xl",label:e.from_user_details.full_name},null,8,["image","label"]),s("div",ie,[s("div",ne,[s("div",oe,[s("div",{class:"text-ink-gray-9",innerHTML:e.subject},null,8,ce)]),s("div",re,[s("div",de,c(i(z)(e.creation).fromNow()),1),e.read?d("",!0):(a(),B(i(T),{key:0,variant:"ghost",onClick:O(m=>y(e.name),["stop"])},{icon:S(()=>[r(i(I),{class:"h-4 w-4 text-ink-gray-7 stroke-1.5"})]),_:1},8,["onClick"]))])]),x(e)?(a(),n("div",{key:0,innerHTML:e.email_content,class:"bg-surface-gray-2 rounded-md px-3 py-2 line-clamp-3 overflow-hidden"},null,8,le)):w(e)?(a(),n("div",ue,[e.document_type=="LMS Course"&&e.document_details.video_link?(a(),n("iframe",{key:0,src:`https://www.youtube.com/embed/${e.document_details.video_link}`,class:"rounded-l-md w-72"},null,8,me)):e.document_type=="LMS Batch"&&e.document_details.video_link?(a(),n("video",{key:1,src:e.document_details.video_link,class:"rounded-l-md w-72"},null,8,_e)):d("",!0),s("div",fe,[s("div",pe,c(e.document_type==="LMS Course"?t.__("New Course"):t.__("New Batch")),1),s("div",he,c(t.__(e.document_details.title)),1),s("div",ke,c(t.__(e.document_details.short_introduction)),1),e.document_details.start_date?(a(),n("div",be,[r(i(W),{class:"size-3 stroke-1.5"}),s("span",null,c(i(z)(e.document_details.start_date).format("DD MMM YYYY")),1)])):d("",!0),e.document_details.start_time?(a(),n("div",ve,[r(i(X),{class:"size-3 stroke-1.5"}),s("span",null,c(i(G)(e.document_details.start_time))+" "+c(e.document_details.timezone),1)])):d("",!0),e.document_details.instructors.length>1?(a(),n("div",ye,[(a(!0),n(h,null,j(e.document_details.instructors,m=>(a(),n("div",xe,[r(i(R),{size:"sm",image:m.user_image,label:m.full_name},null,8,["image","label"]),s("span",we,c(m.full_name),1)]))),256))])):d("",!0)])])):d("",!0)])],10,ae))),128)):(a(),n("div",Ne,c(t.__("Nothing to see here.")),1))])],64)}}};export{Se as default};
//# sourceMappingURL=Notifications-Bjp7SHQg.js.map
