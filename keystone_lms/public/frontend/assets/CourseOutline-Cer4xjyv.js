import{d as J,B as N,aZ as te,a_ as Q,a$ as L,b0 as ae,y as ie,b1 as ue,b2 as be,b3 as he,E as j,b4 as R,b5 as ce,b6 as ve,b7 as se,i as U,b8 as A,b9 as ye,c as E,g as de,u as t,o as i,l as f,w as c,k as I,t as w,e as b,G as H,p as T,a as B,f as y,s as le,H as Ce,J as xe,L as Z,b as C,N as we,ba as De,bb as Se,bc as me,bd as $e,aq as Pe,D as Ne,v as Ee,a7 as Oe,T as S,aF as Ve,q as Me,n as F,P as Ie,aS as Le,_ as oe,be as Te,bf as K,aD as re,bg as Be,bh as ze,bi as Re,bj as Fe,ad as Ue,a8 as qe,F as je,au as Ae}from"./index-H4DTv6Le.js";import{D as ne}from"./vuedraggable.umd-BDbmTq6W.js";var Ge=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ge||{});let pe=Symbol("DisclosureContext");function X(e){let _=U(pe,null);if(_===null){let v=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(v,X),v}return _}let fe=Symbol("DisclosurePanelContext");function He(){return U(fe,null)}let Ke=J({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:_,attrs:v}){let r=N(e.defaultOpen?0:1),l=N(null),h=N(null),d={buttonId:N(`headlessui-disclosure-button-${te()}`),panelId:N(`headlessui-disclosure-panel-${te()}`),disclosureState:r,panel:l,button:h,toggleDisclosure(){r.value=ae(r.value,{0:1,1:0})},closeDisclosure(){r.value!==1&&(r.value=1)},close(a){d.closeDisclosure();let u=a?a instanceof HTMLElement?a:a.value instanceof HTMLElement?L(a):L(d.button):L(d.button);u==null||u.focus()}};return ce(pe,d),ye(j(()=>ae(r.value,{0:A.Open,1:A.Closed}))),()=>{let{defaultOpen:a,...u}=e,g={open:r.value===0,close:d.close};return Q({theirProps:u,ourProps:{},slot:g,slots:_,attrs:v,name:"Disclosure"})}}}),Ze=J({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:_,slots:v,expose:r}){let l=X("DisclosureButton"),h=He(),d=j(()=>h===null?!1:h.value===l.panelId.value);ie(()=>{d.value||e.id!==null&&(l.buttonId.value=e.id)}),ue(()=>{d.value||(l.buttonId.value=null)});let a=N(null);r({el:a,$el:a}),d.value||be(()=>{l.button.value=a.value});let u=he(j(()=>({as:e.as,type:_.type})),a);function g(){var k;e.disabled||(d.value?(l.toggleDisclosure(),(k=L(l.button))==null||k.focus()):l.toggleDisclosure())}function $(k){var P;if(!e.disabled)if(d.value)switch(k.key){case R.Space:case R.Enter:k.preventDefault(),k.stopPropagation(),l.toggleDisclosure(),(P=L(l.button))==null||P.focus();break}else switch(k.key){case R.Space:case R.Enter:k.preventDefault(),k.stopPropagation(),l.toggleDisclosure();break}}function O(k){switch(k.key){case R.Space:k.preventDefault();break}}return()=>{var k;let P={open:l.disclosureState.value===0},{id:z,...o}=e,n=d.value?{ref:a,type:u.value,onClick:g,onKeydown:$}:{id:(k=l.buttonId.value)!=null?k:z,ref:a,type:u.value,"aria-expanded":l.disclosureState.value===0,"aria-controls":l.disclosureState.value===0||L(l.panel)?l.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:g,onKeydown:$,onKeyup:O};return Q({ourProps:n,theirProps:o,slot:P,attrs:_,slots:v,name:"DisclosureButton"})}}}),Je=J({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:_,slots:v,expose:r}){let l=X("DisclosurePanel");ie(()=>{e.id!==null&&(l.panelId.value=e.id)}),ue(()=>{l.panelId.value=null}),r({el:l.panel,$el:l.panel}),ce(fe,l.panelId);let h=ve(),d=j(()=>h!==null?(h.value&A.Open)===A.Open:l.disclosureState.value===0);return()=>{var a;let u={open:l.disclosureState.value===0,close:l.close},{id:g,...$}=e,O={id:(a=l.panelId.value)!=null?a:g,ref:l.panel};return Q({ourProps:O,theirProps:$,slot:u,attrs:_,slots:v,features:se.RenderStrategy|se.Static,visible:d.value,name:"DisclosurePanel"})}}});const Qe={key:1},gt={__name:"CertificationLinks",props:{courseName:{type:String,required:!0}},setup(e){const _=U("$user"),v=e,r=E({url:"lms.lms.api.get_certification_details",makeParams(h){return{course:v.courseName}},auto:!!_.data}),l=()=>{window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${r.data.certificate.name}&format=${encodeURIComponent(r.data.certificate.template)}`)};return(h,d)=>{var u;const a=de("router-link");return t(r).data&&t(r).data.certificate?(i(),f(t(T),{key:0,onClick:l,class:""},{prefix:c(()=>[b(t(H),{class:"size-4 stroke-1.5"})]),default:c(()=>[I(" "+w(h.__("View Certificate")),1)]),_:1})):t(r).data&&t(r).data.membership&&t(r).data.paid_certificate&&((u=t(_).data)!=null&&u.is_student)?(i(),B("div",Qe,[t(r).data.membership.purchased_certificate?t(r).data.membership.certificate?y("",!0):(i(),f(a,{key:1,to:{name:"CourseCertification",params:{courseName:e.courseName}}},{default:c(()=>[b(t(T),{class:"w-full"},{prefix:c(()=>[b(t(H),{class:"size-4 stroke-1.5"})]),default:c(()=>[I(" "+w(h.__("Get Certified")),1)]),_:1})]),_:1},8,["to"])):(i(),f(a,{key:0,to:{name:"Billing",params:{type:"certificate",name:e.courseName}}},{default:c(()=>[b(t(T),{class:"w-full"},{prefix:c(()=>[b(t(H),{class:"size-4 stroke-1.5"})]),default:c(()=>[I(" "+w(h.__("Get Certified")),1)]),_:1})]),_:1},8,["to"]))])):y("",!0)}}},Xe={class:"space-y-4 text-base"},We={key:0},Ye={class:"mb-4"},et={key:1,class:""},tt={class:"flex items-center"},at={class:"border rounded-md p-2 mr-2"},st={class:"flex flex-col"},lt={class:"text-ink-gray-9"},ot={class:"text-sm text-ink-gray-4 mt-1"},rt={__name:"ChapterModal",props:Ee({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const _=le(e,"modelValue"),v=le(e,"outline"),r=U("$user"),{capture:l}=Ce(),{updateOnboardingStep:h}=xe("learning"),d=e,a=Oe({title:"",is_scorm_package:0,scorm_package:null}),u=E({url:"lms.lms.api.upsert_chapter",makeParams(o){var n;return{title:a.title,course:d.course,is_scorm_package:a.is_scorm_package,scorm_package:a.scorm_package,name:(n=d.chapterDetail)==null?void 0:n.name}}}),g=E({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"Chapter Reference",chapter:o.name,parent:d.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),$=async o=>{u.submit({},{validate(){return O()},onSuccess:n=>{var m;(m=r.data)!=null&&m.is_system_manager&&h("create_first_chapter"),l("chapter_created"),g.submit({name:n.name},{onSuccess(V){k(),v.value.reload(),S.success(__("Chapter added successfully"))},onError(V){var M;S.error(((M=V.messages)==null?void 0:M[0])||V)}}),o()},onError(n){var m;S.error(((m=n.messages)==null?void 0:m[0])||n)}})},O=()=>{if(!a.title)return __("Title is required");if(a.is_scorm_package&&!a.scorm_package)return __("Please upload a SCORM package")},k=()=>{a.title="",a.is_scorm_package=0,a.scorm_package=null},P=o=>{u.submit({},{validate(){if(!a.title)return"Title is required"},onSuccess(){v.value.reload(),S.success(__("Chapter updated successfully")),o()},onError(n){var m;S.error(((m=n.messages)==null?void 0:m[0])||n)}})};Z(()=>d.chapterDetail,o=>{a.title=o==null?void 0:o.title,a.is_scorm_package=o==null?void 0:o.is_scorm_package,a.scorm_package=o==null?void 0:o.scorm_package});const z=o=>{if(o.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(o,n)=>(i(),f(t(Ne),{modelValue:_.value,"onUpdate:modelValue":n[4]||(n[4]=m=>_.value=m),options:{title:e.chapterDetail?o.__("Edit Chapter"):o.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?o.__("Edit"):o.__("Create"),variant:"solid",onClick:m=>e.chapterDetail?P(m):$(m)}]}},{"body-content":c(()=>[C("div",Xe,[b(t(we),{label:"Title",modelValue:a.title,"onUpdate:modelValue":n[0]||(n[0]=m=>a.title=m),required:!0},null,8,["modelValue"]),b(t(De),{size:"sm",label:o.__("SCORM Package"),description:o.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:a.is_scorm_package,"onUpdate:modelValue":n[1]||(n[1]=m=>a.is_scorm_package=m)},null,8,["label","description","modelValue"]),a.is_scorm_package?(i(),B("div",We,[a.scorm_package?(i(),B("div",et,[C("div",tt,[C("div",at,[b(t(me),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),C("div",st,[C("span",lt,w(a.scorm_package.file_name),1),C("span",ot,w(t($e)(a.scorm_package.file_size)),1)]),b(t(Pe),{onClick:n[3]||(n[3]=()=>a.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(i(),f(t(Se),{key:0,fileTypes:[".zip"],validateFile:z,onSuccess:n[2]||(n[2]=m=>a.scorm_package=m)},{default:c(({file:m,progress:V,uploading:M,openFileSelector:G})=>[C("div",Ye,[b(t(T),{onClick:G,loading:M},{default:c(()=>[I(w(M?`Uploading ${V}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):y("",!0)])]),_:1},8,["modelValue","options"]))}},nt={class:""},it={class:"chapter-item"},ut=["onClick"],ct={class:"flex ml-auto space-x-4"},dt={class:"flex items-center text-sm leading-5 group"},mt={key:1,class:"flex mt-2 mb-4 pl-8"},kt={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1},lessonProgress:{type:Number,default:0}},setup(e){const _=Ve(),v=Me(),r=U("$user"),l=N(!1),h=N(null),d=Ae(),{$dialog:a}=d.appContext.config.globalProperties,u=e,g=E({url:"lms.lms.utils.get_course_outline",cache:["course_outline",u.courseName],makeParams(){return{course:u.courseName,progress:u.getProgress}},auto:!0});Z(()=>u.courseName,()=>{g.reload()}),Z(()=>u.lessonProgress,()=>{g.reload()});const $=E({url:"lms.lms.api.delete_lesson",makeParams(s){return{lesson:s.lesson,chapter:s.chapter}},onSuccess(){g.reload(),S.success(__("Lesson deleted successfully"))}}),O=E({url:"lms.lms.api.update_lesson_index",makeParams(s){return{lesson:s.lesson,sourceChapter:s.sourceChapter,targetChapter:s.targetChapter,idx:s.idx}},onSuccess(){S.success(__("Lesson moved successfully"))}}),k=E({url:"lms.lms.api.update_chapter_index",makeParams(s){return{chapter:s.chapter,course:s.course,idx:s.idx}},onSuccess(){S.success(__("Chapter moved successfully"))}}),P=(s,D)=>{a({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(q){$.submit({lesson:s,chapter:D}),q()}}]})},z=s=>s==_.params.chapterNumber||s==1,o=(s=null)=>{h.value=s,l.value=!0},n=()=>h.value,m=s=>{O.submit({lesson:s.item.__draggable_context.element.name,sourceChapter:s.from.dataset.chapter,targetChapter:s.to.dataset.chapter,idx:s.newIndex})},V=s=>{k.submit({chapter:s.item.__draggable_context.element.name,course:u.courseName,idx:s.newIndex})},M=E({url:"lms.lms.api.delete_chapter",makeParams(s){return{chapter:s.chapter}},onSuccess(){g.reload(),S.success(__("Chapter deleted successfully"))}}),G=s=>{a({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(D){M.submit({chapter:s}),D()}}]})},_e=s=>{if(s.is_scorm_package&&(event.preventDefault(),!u.allowEdit)){if(!r.data){S.success(__("Please enroll for this course to view this lesson"));return}v.push({name:"SCORMChapter",params:{courseName:u.courseName,chapterName:s.name}})}},ge=s=>_.params.chapterNumber==s.split("-")[0]&&_.params.lessonNumber==s.split("-")[1];return(s,D)=>{var W,Y;const q=de("router-link");return i(),B(je,null,[C("div",nt,[e.title&&((W=t(g).data)!=null&&W.length||e.allowEdit)?(i(),B("div",{key:0,class:F(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[C("div",{class:F(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},w(s.__(e.title)),3),e.allowEdit?(i(),f(t(T),{key:0,size:"sm",onClick:D[0]||(D[0]=p=>o())},{prefix:c(()=>[b(t(Ie),{class:"size-4 stroke-1.5"})]),default:c(()=>[I(" "+w(s.__("Add")),1)]),_:1})):y("",!0)],2)):y("",!0),C("div",{class:F({"border-2 rounded-md py-2 px-2":e.showOutline&&((Y=t(g).data)==null?void 0:Y.length)})},[b(t(ne),{list:t(g).data,disabled:!e.allowEdit,"item-key":"name",group:"chapters",onEnd:V},{item:c(({element:p,index:ke})=>[C("div",it,[(i(),f(t(Ke),{key:p.name,defaultOpen:z(p.idx)},{default:c(({open:ee})=>[b(t(Ze),{ref:"",class:"flex items-center w-full p-2 group"},{default:c(()=>[b(t(Le),{class:F([{"rotate-90 transform duration-200":ee,"duration-200":!ee,hidden:p.is_scorm_package,open:ke==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),C("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:x=>_e(p)},w(p.title),9,ut),C("div",ct,[b(t(oe),{text:s.__("Edit Chapter"),placement:"bottom"},{default:c(()=>[e.allowEdit?(i(),f(t(Te),{key:0,onClick:K(x=>o(p),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):y("",!0)]),_:2},1032,["text"]),b(t(oe),{text:s.__("Delete Chapter"),placement:"bottom"},{default:c(()=>[e.allowEdit?(i(),f(t(re),{key:0,onClick:K(x=>G(p.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):y("",!0)]),_:2},1032,["text"])])]),_:2},1536),p.is_scorm_package?y("",!0):(i(),f(t(Je),{key:0},{default:c(()=>[p.is_scorm_package?y("",!0):(i(),f(t(ne),{key:0,list:p.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:m,"data-chapter":p.name},{item:c(({element:x})=>[C("div",{class:F(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",ge(x.number)?"bg-surface-gray-3":""])},[b(q,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:x.number.split("-")[0],lessonNumber:x.number.split("-")[1]}}},{default:c(()=>[C("div",dt,[x.icon==="icon-youtube"?(i(),f(t(Be),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):x.icon==="icon-quiz"?(i(),f(t(ze),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):x.icon==="icon-assignment"?(i(),f(t(Re),{key:2,class:"h-4 w-4 stroke-1 mr-2"})):x.icon==="icon-code"?(i(),f(t(Fe),{key:3,class:"h-4 w-4 stroke-1 mr-2"})):x.icon==="icon-list"?(i(),f(t(me),{key:4,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):y("",!0),I(" "+w(x.title)+" ",1),e.allowEdit?(i(),f(t(re),{key:5,onClick:K(pt=>P(x.name,p.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):y("",!0),x.is_complete?(i(),f(t(Ue),{key:6,class:"h-4 w-4 text-green-700 ml-2"})):y("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(i(),B("div",mt,[p.is_scorm_package?y("",!0):(i(),f(q,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:p.idx,lessonNumber:p.lessons.length+1}}},{default:c(()=>[b(t(T),null,{default:c(()=>[I(w(s.__("Add Lesson")),1)]),_:1})]),_:1},8,["to"]))])):y("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))])]),_:1},8,["list","disabled"])],2)]),t(r).data?(i(),f(rt,{key:0,modelValue:l.value,"onUpdate:modelValue":D[1]||(D[1]=p=>l.value=p),outline:t(g),"onUpdate:outline":D[2]||(D[2]=p=>qe(g)?g.value=p:null),course:e.courseName,chapterDetail:n()},null,8,["modelValue","outline","course","chapterDetail"])):y("",!0)],64)}}};export{gt as _,kt as a};
//# sourceMappingURL=CourseOutline-Cer4xjyv.js.map
