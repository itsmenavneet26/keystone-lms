import{y as W,c as _,T as p,o as m,a as y,b as o,t as r,u as l,e as d,bt as Y,F as G,r as H,bf as b,N as v,l as z,aq as I,f,ca as L,cb as X,w as U,k as C,P as J,p as B,ad as K,i as Q,B as E,a7 as Z,E as ee,bz as ae}from"./index-H4DTv6Le.js";const te={class:"mt-7 mb-20"},le={class:"mb-4 text-lg font-semibold text-ink-gray-9"},se={key:0,class:"flex items-center space-x-2 text-sm text-ink-gray-7 bg-surface-gray-1 px-3 py-2 rounded-md w-full text-center"},oe={key:1},de={class:"grid grid-cols-3 md:grid-cols-4 gap-4 text-sm text-ink-gray-7 mb-4"},ne={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4 group"},re={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4"},ue={class:"my-10"},ie={class:"mb-4 text-lg font-semibold text-ink-gray-9"},me={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ce={key:0},pe={class:"mb-4 text-lg font-semibold text-ink-gray-9"},ve={key:0,class:"flex items-center bg-surface-green-2 text-green-900 text-sm p-1 rounded-md mb-4 w-fit"},_e={__name:"ProfileEvaluator",props:{profile:{type:Object,required:!0}},setup(M){var T;const g=Q("$user"),A=window.read_only_mode,k=M;W(()=>{var e,a,c;((e=g.data)==null?void 0:e.name)!==((a=k.profile.data)==null?void 0:a.name)&&!N()&&(window.location.href=`/user/${(c=k.profile.data)==null?void 0:c.username}`)});const N=()=>{var e,a;return((e=g.data)==null?void 0:e.is_evaluator)||((a=g.data)==null?void 0:a.is_moderator)},n=()=>{var e,a;return((e=g.data)==null?void 0:e.email)===((a=k.profile.data)==null?void 0:a.name)},h=E(0),V=E(null),S=E(null),s=Z({day:"",start_time:"",end_time:""}),u=_({url:"lms.lms.api.get_evaluator_details",params:{evaluator:(T=k.profile.data)==null?void 0:T.name},auto:!0,onSuccess(e){e.slots.unavailable_from&&(V.value=e.slots.unavailable_from),e.slots.unavailable_to&&(S.value=e.slots.unavailable_to)}}),D=_({url:"frappe.client.insert",makeParams(e){var a;return{doc:{doctype:"Evaluator Schedule",parent:(a=u.data)==null?void 0:a.slots.name,parentfield:"schedule",parenttype:"Course Evaluator",...s}}},onSuccess(){p.success(__("Slot added successfully")),u.reload(),h.value=0,s.day="",s.start_time="",s.end_time=""},onError(e){var a;p.error(((a=e.messages)==null?void 0:a[0])||e)}}),j=_({url:"frappe.client.set_value",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name,fieldname:e.field,value:e.value}},onSuccess(){p.success(__("Availability updated successfully"))},onError(e){var a;p.error(((a=e.messages)==null?void 0:a[0])||e)}}),q=_({url:"frappe.client.delete",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name}},onSuccess(){p.success(__("Slot deleted successfully")),u.reload()},onError(e){var a;p.error(((a=e.messages)==null?void 0:a[0])||e)}}),$=_({url:"frappe.client.set_value",makeParams(e){var a;return{doctype:"Course Evaluator",name:(a=u.data)==null?void 0:a.slots.name,fieldname:e.field,value:e.value}},onSuccess(){p.success(__("Unavailability updated successfully"))},onError(e){var a;p.error(((a=e.messages)==null?void 0:a[0])||e)}}),w=(e,a,c)=>{j.submit({name:e,field:a,value:c},{validate(){if(!c)return`Please enter a value for ${ae(a)}`}})},F=()=>{!s.day||!s.start_time||!s.end_time||D.submit()},O=e=>{q.submit({name:e})},R=_({url:"frappe.integrations.doctype.google_calendar.google_calendar.authorize_access",makeParams(){var e;return{g_calendar:(e=u.data)==null?void 0:e.calendar,reauthorize:1}},onSuccess(e){window.open(e.url)}}),x=ee(()=>[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Sunday",value:"Sunday"}]);return(e,a)=>{var c,P;return m(),y("div",te,[o("h2",le,r(e.__("My availability")),1),l(A)?(m(),y("div",se,[d(l(Y),{class:"size-4 stroke-1.5"}),o("span",null,r(e.__("You cannot change the availability when the site is being updated.")),1)])):(m(),y("div",oe,[o("div",null,[o("div",de,[o("div",null,r(e.__("Day")),1),o("div",null,r(e.__("Start Time")),1),o("div",null,r(e.__("End Time")),1)]),l(u).data?(m(!0),y(G,{key:0},H(l(u).data.slots.schedule,t=>(m(),y("div",ne,[d(l(v),{type:"select",options:x.value,modelValue:t.day,"onUpdate:modelValue":i=>t.day=i,onFocusout:b(i=>w(t.name,"day",t.day),["stop"]),disabled:!n()},null,8,["options","modelValue","onUpdate:modelValue","onFocusout","disabled"]),d(l(v),{type:"time",modelValue:t.start_time,"onUpdate:modelValue":i=>t.start_time=i,onFocusout:b(i=>w(t.name,"start_time",t.start_time),["stop"]),disabled:!n()},null,8,["modelValue","onUpdate:modelValue","onFocusout","disabled"]),d(l(v),{type:"time",modelValue:t.end_time,"onUpdate:modelValue":i=>t.end_time=i,onFocusout:b(i=>w(t.name,"end_time",t.end_time),["stop"]),disabled:!n()},null,8,["modelValue","onUpdate:modelValue","onFocusout","disabled"]),n()?(m(),z(l(I),{key:0,onClick:i=>O(t.name),class:"w-6 h-auto stroke-1.5 text-red-900 rounded-md cursor-pointer p-1 bg-surface-red-2 hidden group-hover:block"},null,8,["onClick"])):f("",!0)]))),256)):f("",!0),L(o("div",re,[d(l(v),{type:"select",options:x.value,modelValue:s.day,"onUpdate:modelValue":a[0]||(a[0]=t=>s.day=t),onFocusout:a[1]||(a[1]=b(t=>F(),["stop"])),disabled:!n()},null,8,["options","modelValue","disabled"]),d(l(v),{type:"time",modelValue:s.start_time,"onUpdate:modelValue":a[2]||(a[2]=t=>s.start_time=t),onFocusout:a[3]||(a[3]=b(t=>F(),["stop"])),disabled:!n()},null,8,["modelValue","disabled"]),d(l(v),{type:"time",modelValue:s.end_time,"onUpdate:modelValue":a[4]||(a[4]=t=>s.end_time=t),onFocusout:a[5]||(a[5]=b(t=>F(),["stop"])),disabled:!n()},null,8,["modelValue","disabled"])],512),[[X,h.value]]),n()?(m(),z(l(B),{key:1,onClick:a[6]||(a[6]=t=>h.value=1)},{prefix:U(()=>[d(l(J),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:U(()=>[C(" "+r(e.__("Add Slot")),1)]),_:1})):f("",!0)]),o("div",ue,[o("h2",ie,r(e.__("I am unavailable")),1),o("div",me,[d(l(v),{type:"date",label:e.__("From"),modelValue:V.value,"onUpdate:modelValue":a[7]||(a[7]=t=>V.value=t),disabled:!n(),onBlur:a[8]||(a[8]=()=>{l($).submit({field:"unavailable_from",value:V.value})})},null,8,["label","modelValue","disabled"]),d(l(v),{type:"date",label:e.__("To"),modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=t=>S.value=t),disabled:!n(),onBlur:a[10]||(a[10]=()=>{l($).submit({field:"unavailable_to",value:S.value})})},null,8,["label","modelValue","disabled"])])]),n()?(m(),y("div",ce,[o("h2",pe,r(e.__("My calendar")),1),(c=l(u).data)!=null&&c.calendar&&((P=l(u).data)!=null&&P.is_authorized)?(m(),y("div",ve,[d(l(K),{class:"h-4 w-4 stroke-1.5 mr-2"}),C(" "+r(e.__("Your calendar is set.")),1)])):f("",!0),d(l(B),{onClick:a[11]||(a[11]=()=>l(R).submit())},{default:U(()=>[C(r(e.__("Authorize Google Calendar Access")),1)]),_:1})])):f("",!0)]))])}}};export{_e as default};
//# sourceMappingURL=ProfileEvaluator-DkkFzRbF.js.map
