import{x as P,y as U,z as W,W as Z,c as G,A as H,o as n,a as m,b as u,e as o,u as s,t as _,w as i,af as I,F as S,r as V,l as b,bx as C,f as v,ag as K,ak as Q,ai as X,ab as Y,Z as ee,p as E,ah as ae,al as se,k as te,cO as le,N as M,S as oe,D as ne,B as h,a7 as ie,E as J,T,i as re}from"./index-H4DTv6Le.js";import{_ as ue}from"./EmptyState.vue_vue_type_script_setup_true_lang-C4EPuQXe.js";import{_ as ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";const me={class:""},de={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},_e={class:"max-w-4xl mx-auto pt-5 p-4"},pe={class:"mb-6"},be={class:"text-xl font-semibold text-ink-gray-7 mb-4 md:mb-0"},fe={key:0},ye={key:0,class:"flex items-center space-x-3"},ge={key:1,class:"flex justify-center"},ke={key:2,class:"text-sm text-ink-gray-6"},ve={key:3},he={class:"flex justify-center mt-5"},je={class:"space-y-4"},we={class:"text-sm text-ink-gray-5 mb-1"},Se={__name:"JobApplications",props:{job:{type:String,required:!0}},setup(N){const R=re("$dayjs"),{brand:z}=P(),y=h(!1),f=h(null),g=h(0),l=ie({subject:"",message:"",replyTo:""}),k=N;U(()=>{L()});const L=()=>{W("frappe.client.get_count",{doctype:"LMS Job Application",filters:{job:k.job}}).then(e=>{g.value=e})},r=Z({doctype:"LMS Job Application",fields:["name","user.user_image as user_image","user.full_name as full_name","user.email as email","creation","resume","job.job_title as job_title"],filters:{job:k.job},auto:!0}),B=G({url:"frappe.core.doctype.communication.email.make",makeParams(e){return{recipients:f.value.email,cc:l.replyTo,subject:l.subject,content:l.message,doctype:"LMS Job Application",name:f.value.name,send_email:1,now:!0}}}),D=e=>{var a,c;f.value=e,l.subject=`Job Application for ${(c=(a=r.data)==null?void 0:a[0])==null?void 0:c.job_title} - ${e.full_name}`,l.replyTo="",l.message="",y.value=!0},q=e=>{B.submit({},{validate(){if(!l.subject)return __("Subject is required");if(!l.message)return __("Message is required")},onSuccess:()=>{T.success(__("Email sent successfully")),e()},onError:a=>{var c;T.error(((c=a.messages)==null?void 0:c[0])||a)}})},F=e=>{window.open(e,"_blank")},O=e=>{const a=[];return e.resume&&a.push({label:__("View Resume"),icon:"download",onClick:()=>F(e.resume)}),a.push({label:__("Send Email"),icon:"mail",onClick:()=>D(e)}),a},j=J(()=>[{label:__("Full Name"),key:"full_name",width:2,icon:"user"},{label:__("Email"),key:"email",width:2,icon:"at-sign"},{label:__("Applied On"),key:"applied_on",width:1,icon:"calendar"},{label:"",key:"actions",width:1}]),w=J(()=>r.data?r.data.map(e=>({...e,full_name:e.full_name,applied_on:R(e.creation).fromNow()})):[]);return H(()=>{var e,a;return{title:`Applications - ${(a=(e=r.data)==null?void 0:e[0])==null?void 0:a.job_title}`,icon:z.favicon}}),(e,a)=>{var c,x,$,A;return n(),m("div",me,[u("header",de,[o(s(ce),{class:"h-7",items:[{label:e.__("Jobs"),route:{name:"Jobs"}},{label:(x=(c=s(r).data)==null?void 0:c[0])==null?void 0:x.job_title,route:{name:"JobDetail",params:{job:k.job}}},{label:e.__("Applications")}]},null,8,["items"])]),u("div",_e,[u("div",pe,[u("h1",be,_(g.value)+" "+_(g.value===1?e.__("Application"):e.__("Applications")),1)]),($=s(r).data)!=null&&$.length?(n(),m("div",fe,[o(s(se),{columns:j.value,rows:w.value,"row-key":"name",options:{showTooltip:!1,selectable:!1}},{default:i(()=>[o(s(I),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:i(()=>[(n(!0),m(S,null,V(j.value,t=>(n(),b(s(K),{item:t,key:t.key},{prefix:i(({item:p})=>{var d;return[p.icon?(n(),b(s(C),{key:0,name:(d=p.icon)==null?void 0:d.toString(),class:"h-4 w-4"},null,8,["name"])):v("",!0)]}),_:2},1032,["item"]))),128))]),_:1}),o(s(Q),null,{default:i(()=>[(n(!0),m(S,null,V(w.value,t=>(n(),b(s(ae),{row:t,class:"cursor-pointer"},{default:i(({column:p,item:d})=>[o(s(X),{item:d},{default:i(()=>[p.key==="full_name"?(n(),m("div",ye,[o(s(Y),{size:"sm",image:t.user_image,label:t.full_name},null,8,["image","label"]),u("span",null,_(d),1)])):p.key==="actions"?(n(),m("div",ge,[o(s(ee),{options:O(t)},{default:i(()=>[o(s(E),{variant:"ghost"},{default:i(()=>[o(s(C),{name:"more-horizontal",class:"w-4 h-4"})]),_:1})]),_:1},8,["options"])])):p.key==="applied_on"?(n(),m("div",ke,_(d),1)):(n(),m("div",ve,_(d),1))]),_:2},1032,["item"])]),_:2},1032,["row"]))),256))]),_:1})]),_:1},8,["columns","rows"]),u("div",he,[s(r).hasNextPage?(n(),b(s(E),{key:0,onClick:a[0]||(a[0]=t=>s(r).next())},{prefix:i(()=>[o(s(le),{class:"size-4 stroke-1.5"})]),default:i(()=>[te(" "+_(e.__("Load More")),1)]),_:1})):v("",!0)])])):s(r).loading?v("",!0):(n(),b(ue,{key:1,type:"Job Applications"}))]),o(s(ne),{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=t=>y.value=t),options:{title:e.__("Send Email to {0}").format((A=f.value)==null?void 0:A.full_name),size:"lg",actions:[{label:e.__("Send"),variant:"solid",onClick:t=>q(t)}]}},{"body-content":i(()=>[u("div",je,[o(s(M),{modelValue:l.subject,"onUpdate:modelValue":a[1]||(a[1]=t=>l.subject=t),label:e.__("Subject"),placeholder:e.__("Enter email subject"),required:""},null,8,["modelValue","label","placeholder"]),o(s(M),{modelValue:l.replyTo,"onUpdate:modelValue":a[2]||(a[2]=t=>l.replyTo=t),label:e.__("Reply To"),placeholder:e.__("Enter reply to email")},null,8,["modelValue","label","placeholder"]),u("div",null,[u("div",we,_(e.__("Message")),1),o(s(oe),{content:l.message,onChange:a[3]||(a[3]=t=>l.message=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["modelValue","options"])])}}};export{Se as default};
//# sourceMappingURL=JobApplications-z6LUvtVZ.js.map
