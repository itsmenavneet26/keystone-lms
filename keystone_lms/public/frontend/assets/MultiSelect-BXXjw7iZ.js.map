{"version":3,"file":"MultiSelect-BXXjw7iZ.js","sources":["../../../../frontend/src/components/Controls/MultiSelect.vue"],"sourcesContent":["<template>\n\t<div>\n\t\t<label v-if=\"label\" class=\"block mb-1\" :class=\"labelClasses\">\n\t\t\t{{ label }}\n\t\t\t<span v-if=\"required\" class=\"text-ink-red-3\">*</span>\n\t\t</label>\n\t\t<Combobox v-model=\"selectedValue\" nullable v-slot=\"{ open }\">\n\t\t\t<div class=\"relative w-full\">\n\t\t\t\t<ComboboxInput\n\t\t\t\t\tref=\"search\"\n\t\t\t\t\tclass=\"form-input w-full focus-visible:!ring-0\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t@change=\"\n\t\t\t\t\t\t(e) => {\n\t\t\t\t\t\t\tquery = e.target.value\n\t\t\t\t\t\t}\n\t\t\t\t\t\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\t@focus=\"onFocus\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxButton ref=\"trigger\" class=\"hidden\" />\n\t\t\t\t<ComboboxOptions\n\t\t\t\t\tv-show=\"open\"\n\t\t\t\t\tstatic\n\t\t\t\t\tclass=\"absolute z-20 mt-1 w-full rounded-lg bg-surface-modal border-2 border-outline-gray-modals max-h-[13rem] flex flex-col\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex-1 my-1 overflow-y-auto px-1.5\"\n\t\t\t\t\t\t:class=\"options.length ? 'min-h-[6rem]' : 'min-h-[3.8rem]'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-if=\"options.length\">\n\t\t\t\t\t\t\t<ComboboxOption\n\t\t\t\t\t\t\t\tv-for=\"option in options\"\n\t\t\t\t\t\t\t\t:key=\"option.value\"\n\t\t\t\t\t\t\t\t:value=\"option\"\n\t\t\t\t\t\t\t\tv-slot=\"{ active }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t\t\t'flex cursor-pointer items-center rounded px-2 py-1 text-base',\n\t\t\t\t\t\t\t\t\t\t{ 'bg-surface-gray-2': active },\n\t\t\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col gap-1 p-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-base font-medium text-ink-gray-8\">\n\t\t\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\t\t\toption.value === option.label\n\t\t\t\t\t\t\t\t\t\t\t\t\t? option.description\n\t\t\t\t\t\t\t\t\t\t\t\t\t: option.label\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-ink-gray-5\">\n\t\t\t\t\t\t\t\t\t\t\t{{ option.value }}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ComboboxOption>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<div v-else class=\"text-ink-gray-7 px-4 py-2\">\n\t\t\t\t\t\t\t{{ __('No results found') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"attrs.onCreate\"\n\t\t\t\t\t\tclass=\"p-1 bg-surface-white border-t rounded-b-lg\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tclass=\"w-full !justify-start\"\n\t\t\t\t\t\t\t:label=\"__('Create New')\"\n\t\t\t\t\t\t\t@click=\"attrs.onCreate()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</ComboboxOptions>\n\t\t\t</div>\n\t\t</Combobox>\n\n\t\t<!-- Selected values -->\n\t\t<div v-if=\"values?.length\" class=\"grid grid-cols-2 gap-2 mt-1\">\n\t\t\t<div\n\t\t\t\tv-for=\"value in values\"\n\t\t\t\t:key=\"value\"\n\t\t\t\tclass=\"flex items-center justify-between break-all bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md\"\n\t\t\t>\n\t\t\t\t<span>{{ value }}</span>\n\t\t\t\t<X\n\t\t\t\t\tclass=\"size-4 stroke-1.5 cursor-pointer\"\n\t\t\t\t\t@click=\"removeValue(value)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script setup>\nimport {\n\tCombobox,\n\tComboboxButton,\n\tComboboxInput,\n\tComboboxOptions,\n\tComboboxOption,\n} from '@headlessui/vue'\nimport { createResource, Button } from 'frappe-ui'\nimport { ref, computed, useAttrs, watch } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\nimport { X, Plus } from 'lucide-vue-next'\n\nconst props = defineProps({\n\tlabel: String,\n\tsize: { type: String, default: 'sm' },\n\tdoctype: { type: String, required: true },\n\tfilters: { type: Object, default: () => ({}) },\n\tvalidate: Function,\n\terrorMessage: {\n\t\ttype: Function,\n\t\tdefault: (value) => `${value} is an Invalid value`,\n\t},\n\trequired: Boolean,\n})\n\nconst values = defineModel()\nconst attrs = useAttrs()\nconst trigger = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst selectedValue = ref(null)\nconst error = ref(null)\n\nconst emit = defineEmits(['update:modelValue'])\n\nwatch(selectedValue, (val) => {\n\tif (!val?.value) return\n\tquery.value = ''\n\taddValue(val.value)\n\tselectedValue.value = null\n\temit('update:modelValue', values.value)\n})\n\nwatchDebounced(\n\tquery,\n\t(val) => {\n\t\tval = val || ''\n\t\tif (text.value === val) return\n\t\ttext.value = val\n\t\treload(val)\n\t},\n\t{ debounce: 300, immediate: true }\n)\n\nconst filterOptions = createResource({\n\turl: 'frappe.desk.search.search_link',\n\tmethod: 'POST',\n\tauto: true,\n\tparams: {\n\t\ttxt: text.value,\n\t\tdoctype: props.doctype,\n\t},\n})\n\nconst options = computed(() => {\n\tconst allOptions = filterOptions.data || []\n\treturn allOptions.filter((option) => !values.value?.includes(option.value))\n})\n\nfunction reload(val) {\n\tfilterOptions.update({\n\t\tparams: {\n\t\t\ttxt: val,\n\t\t\tdoctype: props.doctype,\n\t\t},\n\t})\n\tfilterOptions.reload()\n}\n\nfunction onFocus() {\n\tif (!filterOptions.data?.length) {\n\t\treload('')\n\t}\n\ttrigger.value?.$el.click()\n}\n\nfunction addValue(value) {\n\terror.value = null\n\n\tif (!value) return\n\n\tconst splitValues = value.split(',')\n\n\tsplitValues.forEach((val) => {\n\t\tval = val.trim()\n\n\t\tif (!val) return\n\t\tif (values.value?.includes(val)) return\n\n\t\tif (props.validate && !props.validate(val)) {\n\t\t\terror.value = props.errorMessage(val)\n\t\t\treturn\n\t\t}\n\n\t\tif (!values.value) values.value = [val]\n\t\telse values.value.push(val)\n\t})\n}\n\nfunction removeValue(value) {\n\tlet indexToRemove = values.value.indexOf(value)\n\tif (indexToRemove > -1) {\n\t\tvalues.value.splice(indexToRemove, 1)\n\t}\n\temit('update:modelValue', values.value)\n}\n\nconst labelClasses = computed(() => [\n\t{ sm: 'text-xs', md: 'text-base' }[props.size || 'sm'],\n\t'text-ink-gray-5',\n])\n</script>\n"],"names":["props","__props","values","_useModel","attrs","useAttrs","trigger","ref","query","text","selectedValue","error","emit","__emit","watch","val","addValue","watchDebounced","reload","filterOptions","createResource","options","computed","option","_a","onFocus","_b","value","removeValue","indexToRemove","labelClasses","_createElementBlock","_normalizeClass","_createTextVNode","_toDisplayString","_hoisted_1","_createVNode","_unref","Combobox","$event","_withCtx","open","_createElementVNode","_hoisted_2","ComboboxInput","_cache","e","ComboboxButton","ComboboxOptions","_Fragment","_renderList","_createBlock","ComboboxOption","active","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","__","_openBlock","_hoisted_7","Button","Plus","_hoisted_8","X"],"mappings":"q8BAiHA,MAAMA,EAAQC,EAaRC,EAASC,EAAWF,EAAA,YAAC,EACrBG,EAAQC,EAAQ,EAChBC,EAAUC,EAAI,IAAI,EAClBC,EAAQD,EAAI,EAAE,EACdE,EAAOF,EAAI,EAAE,EACbG,EAAgBH,EAAI,IAAI,EACxBI,EAAQJ,EAAI,IAAI,EAEhBK,EAAOC,EAEbC,EAAMJ,EAAgBK,GAAQ,CACxBA,GAAA,MAAAA,EAAK,QACVP,EAAM,MAAQ,GACdQ,EAASD,EAAI,KAAK,EAClBL,EAAc,MAAQ,KACtBE,EAAK,oBAAqBV,EAAO,KAAK,EACvC,CAAC,EAEDe,EACCT,EACCO,GAAQ,CACRA,EAAMA,GAAO,GACTN,EAAK,QAAUM,IACnBN,EAAK,MAAQM,EACbG,EAAOH,CAAG,EACX,EACA,CAAE,SAAU,IAAK,UAAW,EAAI,CACjC,EAEA,MAAMI,EAAgBC,EAAe,CACpC,IAAK,iCACL,OAAQ,OACR,KAAM,GACN,OAAQ,CACP,IAAKX,EAAK,MACV,QAAST,EAAM,OACjB,CACA,CAAC,EAEKqB,EAAUC,EAAS,KACLH,EAAc,MAAQ,CAAA,GACvB,OAAQI,GAAM,OAAK,SAACC,EAAAtB,EAAO,QAAP,MAAAsB,EAAc,SAASD,EAAO,QAAM,CAC1E,EAED,SAASL,EAAOH,EAAK,CACpBI,EAAc,OAAO,CACpB,OAAQ,CACP,IAAKJ,EACL,QAASf,EAAM,OAClB,CACA,CAAE,EACDmB,EAAc,OAAM,CACrB,CAEA,SAASM,GAAU,UACbD,EAAAL,EAAc,OAAd,MAAAK,EAAoB,QACxBN,EAAO,EAAE,GAEVQ,EAAApB,EAAQ,QAAR,MAAAoB,EAAe,IAAI,OACpB,CAEA,SAASV,EAASW,EAAO,CAGxB,GAFAhB,EAAM,MAAQ,KAEV,CAACgB,EAAO,OAEQA,EAAM,MAAM,GAAG,EAEvB,QAASZ,GAAQ,OAG5B,GAFAA,EAAMA,EAAI,KAAI,EAEV,EAACA,GACD,GAAAS,EAAAtB,EAAO,QAAP,MAAAsB,EAAc,SAAST,IAE3B,IAAIf,EAAM,UAAY,CAACA,EAAM,SAASe,CAAG,EAAG,CAC3CJ,EAAM,MAAQX,EAAM,aAAae,CAAG,EACpC,MACD,CAEKb,EAAO,MACPA,EAAO,MAAM,KAAKa,CAAG,EADPb,EAAO,MAAQ,CAACa,CAAG,EAEvC,CAAC,CACF,CAEA,SAASa,EAAYD,EAAO,CAC3B,IAAIE,EAAgB3B,EAAO,MAAM,QAAQyB,CAAK,EAC1CE,EAAgB,IACnB3B,EAAO,MAAM,OAAO2B,EAAe,CAAC,EAErCjB,EAAK,oBAAqBV,EAAO,KAAK,CACvC,CAEA,MAAM4B,EAAeR,EAAS,IAAM,CACnC,CAAE,GAAI,UAAW,GAAI,WAAW,EAAGtB,EAAM,MAAQ,IAAI,EACrD,iBACD,CAAC,iCA5NA+B,EAgGM,MAAA,KAAA,CA/FQ9B,EAAA,WAAb8B,EAGQ,QAAA,OAHY,MAAKC,EAAA,CAAC,aAAqBF,EAAA,KAAY,CAAA,IACvDG,EAAAC,EAAAjC,EAAA,KAAK,EAAG,IACX,CAAA,EAAYA,EAAA,cAAZ8B,EAAqD,OAArDI,GAA6C,GAAC,0BAE/CC,EA2EWC,EAAAC,CAAA,EAAA,YA3EQ5B,EAAA,2CAAAA,EAAa,MAAA6B,GAAE,SAAA,KACjC,QAAAC,EAAA,CAyEM,CA1E8C,KAAAC,KAAI,CACxDC,EAyEM,MAzENC,GAyEM,CAxELP,EAWEC,EAAAO,CAAA,EAAA,CAVD,IAAI,SACJ,MAAM,0CACN,KAAK,OACJ,SAAMC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAUC,GAAC,CAActC,EAAA,MAAQsC,EAAE,OAAO,QAKjD,aAAa,MACZ,QAAOrB,aAETW,EAA+CC,EAAAU,CAAA,EAAA,SAA3B,UAAJ,IAAIzC,EAAU,MAAM,sBACpC8B,EA0DkBC,EAAAW,CAAA,EAAA,CAxDjB,OAAA,GACA,MAAM,oIAEN,IAoCM,CApCNN,EAoCM,MAAA,CAnCL,MAAKV,EAAA,CAAC,qCACEX,EAAA,MAAQ,OAAM,eAAA,gBAAA,CAAA,IAENA,EAAA,MAAQ,cACvBU,EAyBiBkB,EAAA,CAAA,IAAA,CAAA,EAAAC,EAxBC7B,EAAA,MAAVE,QADR4B,EAyBiBd,EAAAe,CAAA,EAAA,CAvBf,IAAK7B,EAAO,MACZ,MAAOA,IAGR,QAAAiB,EAAA,CAkBK,CApBK,OAAAa,KAAM,CAEhBX,EAkBK,KAAA,CAjBH,MAAKV,EAAA,qFAA+GqB,CAAM,MAK3HX,EAWM,MAXNY,GAWM,CAVLZ,EAMM,MANNa,GAMMrB,EAJJX,EAAO,QAAUA,EAAO,MAAqBA,EAAO,YAA2BA,EAAO,KAAK,EAAA,CAAA,EAK7FmB,EAEM,MAFNc,GAEMtB,EADFX,EAAO,KAAK,EAAA,CAAA,4CAOpBQ,EAEM,MAFN0B,GAEMvB,EADFwB,EAAAA,GAAE,kBAAA,CAAA,EAAA,CAAA,OAKArB,EAAAjC,CAAA,EAAM,UADbuD,IAAA5B,EAcM,MAdN6B,GAcM,CAVLxB,EASSC,EAAAwB,CAAA,EAAA,CARR,QAAQ,QACR,MAAM,wBACL,MAAOH,EAAAA,GAAE,YAAA,EACT,QAAKb,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAN,GAAEF,EAAAjC,CAAA,EAAM,SAAQ,KAEX,SACV,IAAmC,CAAnCgC,EAAmCC,EAAAyB,CAAA,EAAA,CAA7B,MAAM,oBAAoB,CAAA,kDArD3BrB,CAAI,gCA8DJjB,EAAAtB,EAAA,QAAA,MAAAsB,EAAQ,QAAnBmC,IAAA5B,EAYM,MAZNgC,GAYM,QAXLhC,EAUMkB,EAAA,KAAAC,EATWhD,EAAA,MAATyB,QADRI,EAUM,MAAA,CARJ,IAAKJ,EACN,MAAM,iGAENe,EAAwB,cAAff,CAAK,EAAA,CAAA,EACdS,EAGEC,EAAA2B,EAAA,EAAA,CAFD,MAAM,mCACL,QAAKzB,GAAEX,EAAYD,CAAK"}