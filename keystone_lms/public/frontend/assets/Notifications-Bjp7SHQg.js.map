{"version":3,"file":"Notifications-Bjp7SHQg.js","sources":["../../../../frontend/src/pages/Notifications.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t<Button\n\t\t\t\t@click=\"markAllAsRead.submit\"\n\t\t\t\t:loading=\"markAllAsRead.loading\"\n\t\t\t\tv-if=\"activeTab === 'Unread' && unReadNotifications.data?.length > 0\"\n\t\t\t>\n\t\t\t\t{{ __('Mark all as read') }}\n\t\t\t</Button>\n\t\t\t<TabButtons\n\t\t\t\tclass=\"inline-block\"\n\t\t\t\t:buttons=\"[{ label: 'Unread', active: true }, { label: 'Read' }]\"\n\t\t\t\tv-model=\"activeTab\"\n\t\t\t/>\n\t\t</div>\n\t</header>\n\t<div class=\"w-full md:w-3/4 mx-auto px-5 pt-6 divide-y\">\n\t\t<div\n\t\t\tv-if=\"notifications?.length\"\n\t\t\tv-for=\"log in notifications\"\n\t\t\t:key=\"log.name\"\n\t\t\tclass=\"flex space-x-2 px-2 py-4\"\n\t\t\t:class=\"{\n\t\t\t\t'cursor-pointer': log.link,\n\t\t\t\t'items-center': !showDetails(log) && !isMentionOrComment(log),\n\t\t\t}\"\n\t\t\t@click=\"navigateToPage(log)\"\n\t\t>\n\t\t\t<Avatar\n\t\t\t\t:image=\"log.from_user_details.user_image\"\n\t\t\t\tsize=\"xl\"\n\t\t\t\t:label=\"log.from_user_details.full_name\"\n\t\t\t/>\n\t\t\t<div class=\"space-y-2 w-full\">\n\t\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\"text-ink-gray-9\" v-html=\"log.subject\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<div class=\"text-sm text-ink-gray-5\">\n\t\t\t\t\t\t\t{{ dayjs(log.creation).fromNow() }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tv-if=\"!log.read\"\n\t\t\t\t\t\t\t@click.stop=\"(e) => handleMarkAsRead(log.name)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<X class=\"h-4 w-4 text-ink-gray-7 stroke-1.5\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isMentionOrComment(log)\"\n\t\t\t\t\tv-html=\"log.email_content\"\n\t\t\t\t\tclass=\"bg-surface-gray-2 rounded-md px-3 py-2 line-clamp-3 overflow-hidden\"\n\t\t\t\t></div>\n\t\t\t\t<div\n\t\t\t\t\tv-else-if=\"showDetails(log)\"\n\t\t\t\t\tclass=\"flex items-stretch border border-outline-gray-2 space-x-2 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<iframe\n\t\t\t\t\t\tv-if=\"\n\t\t\t\t\t\t\tlog.document_type == 'LMS Course' &&\n\t\t\t\t\t\t\tlog.document_details.video_link\n\t\t\t\t\t\t\"\n\t\t\t\t\t\t:src=\"`https://www.youtube.com/embed/${log.document_details.video_link}`\"\n\t\t\t\t\t\tclass=\"rounded-l-md w-72\"\n\t\t\t\t\t/>\n\t\t\t\t\t<video\n\t\t\t\t\t\tv-else-if=\"\n\t\t\t\t\t\t\tlog.document_type == 'LMS Batch' &&\n\t\t\t\t\t\t\tlog.document_details.video_link\n\t\t\t\t\t\t\"\n\t\t\t\t\t\t:src=\"log.document_details.video_link\"\n\t\t\t\t\t\tclass=\"rounded-l-md w-72\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"p-3\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"bg-surface-violet-1 w-fit py-1 px-1.5 rounded-full text-ink-violet-1 text-sm mb-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tlog.document_type === 'LMS Course'\n\t\t\t\t\t\t\t\t\t? __('New Course')\n\t\t\t\t\t\t\t\t\t: __('New Batch')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"font-semibold mb-1\">\n\t\t\t\t\t\t\t{{ __(log.document_details.title) }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"leading-5\">\n\t\t\t\t\t\t\t{{ __(log.document_details.short_introduction) }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"log.document_details.start_date\"\n\t\t\t\t\t\t\tclass=\"flex items-center space-x-2 text-sm mt-5\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Calendar class=\"size-3 stroke-1.5\" />\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tdayjs(log.document_details.start_date).format('DD MMM YYYY')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"log.document_details.start_time\"\n\t\t\t\t\t\t\tclass=\"flex items-center space-x-2 text-sm mt-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Clock class=\"size-3 stroke-1.5\" />\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t{{ formatTime(log.document_details.start_time) }}\n\t\t\t\t\t\t\t\t{{ log.document_details.timezone }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"log.document_details.instructors.length > 1\"\n\t\t\t\t\t\t\tclass=\"space-y-2 mt-5\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-for=\"instructor in log.document_details.instructors\"\n\t\t\t\t\t\t\t\tclass=\"flex items-center space-x-2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t:size=\"'sm'\"\n\t\t\t\t\t\t\t\t\t:image=\"instructor.user_image\"\n\t\t\t\t\t\t\t\t\t:label=\"instructor.full_name\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span class=\"font-medium text-sm\">\n\t\t\t\t\t\t\t\t\t{{ instructor.full_name }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"text-ink-gray-5\">\n\t\t\t{{ __('Nothing to see here.') }}\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tAvatar,\n\tBreadcrumbs,\n\tButton,\n\tcreateListResource,\n\tcreateResource,\n\tdayjs,\n\tTabButtons,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { sessionStore } from '../stores/session'\nimport { computed, inject, ref, onMounted, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { Calendar, Clock, X } from 'lucide-vue-next'\nimport { formatTime } from '@/utils/'\n\nconst { brand } = sessionStore()\nconst user = inject('$user')\nconst socket = inject('$socket')\nconst activeTab = ref('Unread')\nconst router = useRouter()\n\nonMounted(() => {\n\tif (!user.data) router.push({ name: 'Courses' })\n\n\tsocket.on('publish_lms_notifications', (data) => {\n\t\tunReadNotifications.reload()\n\t})\n})\n\nconst notifications = computed(() => {\n\treturn activeTab.value === 'Unread'\n\t\t? unReadNotifications.data\n\t\t: readNotifications.data\n})\n\nconst unReadNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\turl: 'lms.lms.api.get_notifications',\n\tfilters: {\n\t\tread: 0,\n\t},\n\tauto: user.data ? true : false,\n\tcache: 'Unread Notifications',\n})\n\nconst readNotifications = createListResource({\n\tdoctype: 'Notification Log',\n\turl: 'lms.lms.api.get_notifications',\n\tfilters: {\n\t\tread: 1,\n\t},\n\tauto: user.data ? true : false,\n\tcache: 'Read Notifications',\n})\n\nconst markAsRead = createResource({\n\turl: 'frappe.desk.doctype.notification_log.notification_log.mark_as_read',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdocname: values.name,\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst markAllAsRead = createResource({\n\turl: 'frappe.desk.doctype.notification_log.notification_log.mark_all_as_read',\n\tonSuccess(data) {\n\t\tunReadNotifications.reload()\n\t\treadNotifications.reload()\n\t},\n})\n\nconst handleMarkAsRead = (logName) => {\n\tmarkAsRead.submit({ name: logName })\n}\n\nconst navigateToPage = (log) => {\n\tif (!log.link) return\n\thandleMarkAsRead(log.name)\n\tlet link = log.link.split('/')\n\tif (link[2] == 'courses') {\n\t\trouter.push({\n\t\t\tname: 'CourseDetail',\n\t\t\tparams: { courseName: link[3] },\n\t\t})\n\t} else if (link.includes('batches')) {\n\t\tif (link.includes('details')) {\n\t\t\trouter.push({\n\t\t\t\tname: 'BatchDetail',\n\t\t\t\tparams: { batchName: link.pop() },\n\t\t\t})\n\t\t} else {\n\t\t\trouter.push({\n\t\t\t\tname: 'Batch',\n\t\t\t\tparams: { batchName: link.pop() },\n\t\t\t})\n\t\t}\n\t} else if (link.includes('assignment-submission')) {\n\t\trouter.push({\n\t\t\tname: 'AssignmentSubmission',\n\t\t\tparams: {\n\t\t\t\tsubmissionName: link[4],\n\t\t\t\tassignmentID: link[3],\n\t\t\t},\n\t\t})\n\t}\n}\n\nconst isMentionOrComment = (log) => {\n\tif (log.type == 'Mention') {\n\t\treturn true\n\t}\n\tif (log.subject.includes('mentioned you')) {\n\t\treturn true\n\t}\n\tif (log.subject.includes('comment')) {\n\t\treturn true\n\t}\n\treturn false\n}\n\nconst showDetails = (log) => {\n\treturn (\n\t\t['LMS Course', 'LMS Batch'].includes(log.document_type) &&\n\t\tlog.document_details\n\t)\n}\n\nonUnmounted(() => {\n\tsocket.off('publish_lms_notifications')\n})\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: 'Notifications',\n\t\t\troute: {\n\t\t\t\tname: 'Notifications',\n\t\t\t},\n\t\t},\n\t]\n\treturn crumbs\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: 'Notifications',\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["brand","sessionStore","user","inject","socket","activeTab","ref","router","useRouter","onMounted","data","unReadNotifications","notifications","computed","readNotifications","createListResource","markAsRead","createResource","values","markAllAsRead","handleMarkAsRead","logName","navigateToPage","log","link","isMentionOrComment","showDetails","onUnmounted","breadcrumbs","usePageMeta","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","_hoisted_2","_createBlock","Button","__","TabButtons","$event","_hoisted_3","_b","_createElementBlock","_Fragment","_renderList","Avatar","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_9","_hoisted_10","_toDisplayString","dayjs","e","X","_openBlock","_hoisted_12","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","Calendar","_hoisted_20","Clock","formatTime","_hoisted_21","instructor","_hoisted_22","_hoisted_23","_hoisted_24"],"mappings":"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"}