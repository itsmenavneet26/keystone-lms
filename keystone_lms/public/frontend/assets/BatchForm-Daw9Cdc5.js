import{x as Q,J as W,H as X,y as Y,ay as ee,K as ae,c as y,T as g,ax as C,A as te,o as V,a as S,b as s,e as o,u as n,l as le,w as U,aD as se,p as N,f as x,k as E,t as m,N as i,S as oe,a9 as _,R as D,au as ne,i as ie,a7 as M,B as de,av as T,aw as re,q as me,E as ue,O as f,z as ce}from"./index-H4DTv6Le.js";import{_ as pe}from"./MultiSelect-BXXjw7iZ.js";import{_ as be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";const _e={class:""},fe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},he={class:"flex items-center space-x-2"},ye={class:"py-5"},ge={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Ve={class:"text-lg text-ink-gray-9 font-semibold mb-4"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},we={class:"space-y-5"},ke={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Be={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ce={class:"grid grid-cols-1 md:grid-cols-3 gap-5"},Se={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Ue={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ne={class:"grid grid-cols-1 md:grid-cols-3 gap-10"},xe={class:"space-y-5"},Ee={class:"space-y-5"},De={class:"space-y-5"},Me={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Te={class:"block text-sm text-ink-gray-5 mb-1"},qe={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Oe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},$e={class:"grid grid-cols-1 md:grid-cols-3 gap-10"},ze={class:"space-y-5"},Le={class:"space-y-5"},Pe={class:"space-y-5"},Ie={class:"px-5 md:px-20 pb-5 space-y-5"},Ae={class:"text-lg text-ink-gray-9 font-semibold"},je={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-5"},Ke={class:"px-5 md:px-20 pb-5 space-y-5 border-b"},Fe={class:"text-lg text-ink-gray-9 font-semibold"},He={class:"space-y-5"},Ge={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(q){const h=me(),v=ie("$user"),{brand:O}=Q(),{updateOnboardingStep:$}=W("learning"),p=de([]),z=ne(),{capture:w}=X(),{$dialog:L}=z.appContext.config.globalProperties,r=q,t=M({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",confirmation_email_template:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,certification:!1,meta_image:null,paid_batch:!1,currency:"",amount:0,zoom_account:"",video_link:""}),u=M({description:"",keywords:""});Y(()=>{v.data||(window.location.href="/login"),r.batchName!="new"?P():w("batch_form_opened"),window.addEventListener("keydown",k)});const P=()=>{c.reload(),ee("batches",r.batchName,u)},k=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(B(),e.preventDefault())};ae(()=>{window.removeEventListener("keydown",k)});const I=y({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Batch",meta_image:t.image,video_link:t.video_link,instructors:p.value.map(a=>({instructor:a})),...t}}}}),c=y({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:r.batchName}},onSuccess(e){A(e)}}),A=e=>{Object.keys(e).forEach(d=>{d=="instructors"?e.instructors.forEach(l=>{p.value.push(l.instructor)}):["start_time","end_time"].includes(d)?t[d]=j(e[d]):Object.hasOwn(t,d)&&(t[d]=e[d])});let a=["published","paid_batch","allow_self_enrollment","certification"];for(let d in a){let l=a[d];t[l]=!!t[l]}},j=e=>{let[a,d,l]=e.split(":");return a=a.length==1?"0"+a:a,`${a}:${d}`},K=y({url:"frappe.client.set_value",makeParams(e){return{doctype:"LMS Batch",name:r.batchName,fieldname:{meta_image:t.meta_image,video_link:t.video_link,instructors:p.value.map(a=>({instructor:a})),...t}}}}),F=()=>{t.description=T(t.description),t.batch_details=T(t.batch_details),Object.keys(t).forEach(e=>{!["description","batch_details"].includes(e)&&typeof t[e]=="string"&&(t[e]=re(t[e]))})},B=()=>{F(),c.data?R():H()},H=()=>{I.submit({},{onSuccess(e){var a;(a=v.data)!=null&&a.is_system_manager&&$("create_first_batch",!0,!1,()=>{localStorage.setItem("firstBatch",e.name)}),C("batches",e.name,u),w("batch_created"),h.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;g.error(((a=e.messages)==null?void 0:a[0])||e)}})},R=()=>{K.submit({},{onSuccess(e){C("batches",e.name,u),h.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;g.error(((a=e.messages)==null?void 0:a[0])||e)}})},Z=()=>{L({title:__("Confirm your action to delete"),message:__("Deleting this batch will also delete all its data including enrolled students, linked courses, assessments, feedback and discussions. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick({close:e}){J(e),e()}}]})},J=e=>{ce("lms.lms.api.delete_batch",{batch:r.batchName}).then(()=>{g.success(__("Batch deleted successfully")),e(),h.push({name:"Batches"})})},G=ue(()=>{let e=[{label:__("Batches"),route:{name:"Batches"}}];return c.data&&e.push({label:c.data.title,route:{name:"BatchDetail",params:{batchName:r.batchName}}}),e.push({label:r.batchName=="new"?__("New Batch"):__("Edit Batch"),route:{name:"BatchForm",params:{batchName:r.batchName}}}),e});return te(()=>{var e;return{title:r.batchName=="new"?"New Batch":(e=c.data)==null?void 0:e.title,icon:O.favicon}}),(e,a)=>{var d;return V(),S("div",_e,[s("header",fe,[o(n(be),{class:"h-7",items:G.value},null,8,["items"]),s("div",he,[(d=n(c).data)!=null&&d.name?(V(),le(n(N),{key:0,onClick:Z},{icon:U(()=>[o(n(se),{class:"size-4 stroke-1.5"})]),_:1})):x("",!0),o(n(N),{variant:"solid",onClick:a[0]||(a[0]=l=>B())},{default:U(()=>[E(m(e.__("Save")),1)]),_:1})])]),s("div",ye,[s("div",ge,[s("div",Ve,m(e.__("Details")),1),s("div",ve,[s("div",we,[o(n(i),{modelValue:t.title,"onUpdate:modelValue":a[1]||(a[1]=l=>t.title=l),label:e.__("Title"),required:!0,class:"w-full"},null,8,["modelValue","label"]),o(pe,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=l=>p.value=l),doctype:"Course Evaluator",label:e.__("Instructors"),required:!0,onCreate:l=>n(f)("Evaluators",l),filters:{ignore_user_type:1}},null,8,["modelValue","label","onCreate"])]),o(n(i),{modelValue:t.description,"onUpdate:modelValue":a[3]||(a[3]=l=>t.description=l),label:e.__("Short Description"),type:"textarea",rows:8,placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"])])]),s("div",ke,[s("div",Be,m(e.__("Settings")),1),s("div",Ce,[o(n(i),{modelValue:t.published,"onUpdate:modelValue":a[4]||(a[4]=l=>t.published=l),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.allow_self_enrollment,"onUpdate:modelValue":a[5]||(a[5]=l=>t.allow_self_enrollment=l),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.certification,"onUpdate:modelValue":a[6]||(a[6]=l=>t.certification=l),type:"checkbox",label:e.__("Certification")},null,8,["modelValue","label"])])]),s("div",Se,[s("div",Ue,m(e.__("Date and Time")),1),s("div",Ne,[s("div",xe,[o(n(i),{modelValue:t.start_date,"onUpdate:modelValue":a[7]||(a[7]=l=>t.start_date=l),label:e.__("Batch Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_date,"onUpdate:modelValue":a[8]||(a[8]=l=>t.end_date=l),label:e.__("Batch End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",Ee,[o(n(i),{modelValue:t.start_time,"onUpdate:modelValue":a[9]||(a[9]=l=>t.start_time=l),label:e.__("Session Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_time,"onUpdate:modelValue":a[10]||(a[10]=l=>t.end_time=l),label:e.__("Session End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",De,[o(n(i),{modelValue:t.timezone,"onUpdate:modelValue":a[11]||(a[11]=l=>t.timezone=l),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),o(n(i),{modelValue:t.evaluation_end_date,"onUpdate:modelValue":a[12]||(a[12]=l=>t.evaluation_end_date=l),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])])])]),s("div",Me,[s("div",null,[s("label",Te,[E(m(e.__("Batch Details"))+" ",1),a[26]||(a[26]=s("span",{class:"text-ink-red-3"},"*",-1))]),o(n(oe),{content:t.batch_details,onChange:a[13]||(a[13]=l=>t.batch_details=l),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[20rem] overflow-y-scroll mb-4"},null,8,["content"])])]),s("div",qe,[s("div",Oe,m(e.__("Configurations")),1),s("div",$e,[s("div",ze,[o(n(i),{modelValue:t.seat_count,"onUpdate:modelValue":a[14]||(a[14]=l=>t.seat_count=l),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),o(_,{doctype:"Email Template",label:e.__("Email Template"),modelValue:t.confirmation_email_template,"onUpdate:modelValue":a[15]||(a[15]=l=>t.confirmation_email_template=l),onCreate:(l,b)=>{n(f)("Email Templates",b)}},null,8,["label","modelValue","onCreate"]),o(_,{doctype:"LMS Zoom Settings",label:e.__("Zoom Account"),modelValue:t.zoom_account,"onUpdate:modelValue":a[16]||(a[16]=l=>t.zoom_account=l),onCreate:(l,b)=>{n(f)("Zoom Accounts",b)}},null,8,["label","modelValue","onCreate"])]),s("div",Le,[o(n(i),{modelValue:t.medium,"onUpdate:modelValue":a[17]||(a[17]=l=>t.medium=l),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(_,{doctype:"LMS Category",label:e.__("Category"),modelValue:t.category,"onUpdate:modelValue":a[18]||(a[18]=l=>t.category=l),onCreate:(l,b)=>n(f)("Categories",b)},null,8,["label","modelValue","onCreate"])]),s("div",Pe,[o(D,{modelValue:t.video_link,"onUpdate:modelValue":a[19]||(a[19]=l=>t.video_link=l),label:e.__("Preview Video"),type:"video",required:!1},null,8,["modelValue","label"])])])]),s("div",Ie,[s("div",Ae,m(e.__("Pricing")),1),o(n(i),{modelValue:t.paid_batch,"onUpdate:modelValue":a[20]||(a[20]=l=>t.paid_batch=l),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),t.paid_batch?(V(),S("div",je,[o(n(i),{modelValue:t.amount,"onUpdate:modelValue":a[21]||(a[21]=l=>t.amount=l),label:e.__("Amount"),type:"number"},null,8,["modelValue","label"]),o(_,{doctype:"Currency",modelValue:t.currency,"onUpdate:modelValue":a[22]||(a[22]=l=>t.currency=l),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])):x("",!0)]),s("div",Ke,[s("div",Fe,m(e.__("Meta Tags")),1),s("div",He,[o(D,{modelValue:t.meta_image,"onUpdate:modelValue":a[23]||(a[23]=l=>t.meta_image=l),label:e.__("Meta Image"),type:"image",required:!1},null,8,["modelValue","label"]),o(n(i),{modelValue:u.description,"onUpdate:modelValue":a[24]||(a[24]=l=>u.description=l),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),o(n(i),{modelValue:u.keywords,"onUpdate:modelValue":a[25]||(a[25]=l=>u.keywords=l),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])])}}};export{Ge as default};
//# sourceMappingURL=BatchForm-Daw9Cdc5.js.map
