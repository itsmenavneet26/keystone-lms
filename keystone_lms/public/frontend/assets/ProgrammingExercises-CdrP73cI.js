import{_ as le}from"./EmptyState.vue_vue_type_script_setup_true_lang-C4EPuQXe.js";import{d as G,s as Y,B as C,L as B,f5 as oe,o as g,a as x,b as r,t as v,am as K,F as R,r as F,ca as re,eW as ne,f as N,e as a,u as e,p as $,w as l,bI as ie,n as ue,aD as Q,k as V,P as Z,v as J,aX as ce,W as ee,l as U,D as de,T as D,f6 as me,co as se,N as O,S as _e,a2 as ge,E as W,g as te,aw as pe,x as fe,y as ve,z as X,A as xe,al as ye,a8 as be,i as he,q as ke,au as we,af as Ce,ak as Ee,ai as Ve,aj as $e,ah as Pe,bp as De,bx as Se}from"./index-H4DTv6Le.js";import{_ as Te}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";const Ie={class:"text-xs text-ink-gray-5 mb-2"},Me={class:"overflow-visible border border-outline-gray-modals rounded-md"},Le={class:"overflow-x-auto"},ze=["onUpdate:modelValue"],je={class:"relative"},Re=["onClick"],Ue={class:"mt-2"},Ne=G({__name:"ChildTable",props:J({modelValue:{},columns:{default:()=>[]},label:{}},{modelValue:{},modelModifiers:{}}),emits:J(["update:modelValue"],["update:modelValue"]),setup(P,{emit:T}){const d=Y(P,"modelValue"),b=C(null),y=C(null),m=T,_=C(P.columns);B(d,()=>{d.value&&d.value.length<1&&E()});const E=()=>{d.value||(d.value=[]);let o={};_.value.forEach(p=>{o[p.toLowerCase().split(" ").join("_")]=""}),d.value.push(o),h(),m("update:modelValue",d.value)},h=()=>{ce(()=>{const p=document.querySelectorAll(".overflow-x-auto .grid")[d.value.length].querySelector("input");p&&p.focus()})},I=o=>{var p;(p=d.value)==null||p.splice(o,1),m("update:modelValue",d.value??[])},z=()=>[...Array(_.value.length).fill("1fr"),"0.25fr"].join(" "),A=(o,p)=>{y.value=y.value===o?null:o};oe(b,()=>{y.value=null});const j=o=>_.value.map(k=>k.toLowerCase().split(" ").join("_")).includes(o);return(o,p)=>(g(),x("div",null,[r("div",Ie,v(P.label),1),r("div",Me,[r("div",Le,[r("div",{class:"grid items-center space-x-4 p-2 border-b border-outline-gray-modals",style:K({gridTemplateColumns:z()})},[(g(!0),x(R,null,F(_.value,(k,w)=>(g(),x("div",{key:w,class:"text-sm text-ink-gray-5"},v(k),1))),128)),p[0]||(p[0]=r("div",null,null,-1))],4),(g(!0),x(R,null,F(d.value,(k,w)=>{var s;return g(),x("div",{key:w,class:"grid items-center space-x-4 p-2",style:K({gridTemplateColumns:z()})},[(g(!0),x(R,null,F(Object.keys(k),t=>(g(),x(R,{key:t},[j(t)?re((g(),x("input",{key:0,"onUpdate:modelValue":n=>k[t]=n,class:"py-1.5 px-2 w-full border-none bg-transparent text-ink-gray-8 focus:ring-0 focus:border focus:border-outline-gray-3 focus:bg-surface-gray-2 rounded-md text-sm focus:outline-none"},null,8,ze)),[[ne,k[t]]]):N("",!0)],64))),128)),r("div",je,[a(e($),{variant:"ghost",onClick:t=>A(w)},{icon:l(()=>[a(e(ie),{class:"size-4 text-ink-gray-7 stroke-1.5 cursor-pointer"})]),_:1},8,["onClick"]),y.value===w?(g(),x("div",{key:0,ref_for:!0,ref_key:"menuRef",ref:b,class:ue(["absolute right-0 w-32 z-50 bg-surface-modal border border-outline-gray-modals rounded-md shadow-sm",w==(((s=d.value)==null?void 0:s.length)??0)-1?"bottom-full mb-1":"top-full mt-1"])},[r("button",{onClick:t=>I(w),class:"flex items-center space-x-2 w-full text-left px-3 py-2 text-sm text-ink-red-3"},[a(e(Q),{class:"size-4 stroke-1.5"}),r("span",null,v(o.__("Delete")),1)],8,Re)],2)):N("",!0)])],4)}),128))])]),r("div",Ue,[a(e($),{onClick:E},{prefix:l(()=>[a(e(Z),{class:"size-4 text-ink-gray-7"})]),default:l(()=>[V(" "+v(o.__("Add Row")),1)]),_:1})])]))}}),Ae={class:"flex items-center space-x-2"},qe={class:"text-xl font-semibold text-ink-gray-9"},Be={class:"grid grid-cols-2 gap-10"},Fe={class:"space-y-4"},Oe={class:"text-xs text-ink-gray-5 mb-2"},Ye={class:"flex justify-end space-x-2 group"},Je=G({__name:"ProgrammingExerciseForm",props:J({exerciseID:{default:"new"}},{modelValue:{},modelModifiers:{},exercises:{},exercisesModifiers:{}}),emits:["update:modelValue","update:exercises"],setup(P){const T=Y(P,"modelValue"),d=Y(P,"exercises"),b=C(!1),y=C(0),m=C({title:"",language:"Python",problem_statement:"",test_cases:[]}),L=[{label:"Python",value:"Python"},{label:"JavaScript",value:"JavaScript"}],_=P;B(()=>_.exerciseID,()=>{E(),I()});const E=()=>{var t;let s=!0;(t=d.value)==null||t.data.forEach(n=>{n.name===_.exerciseID&&(s=!1,m.value={...n})}),s&&(m.value={title:"",language:"Python",problem_statement:"",test_cases:[]}),b.value=!1},h=ee({doctype:"LMS Test Case",fields:["input","expected_output","name"],cache:["testCases",_.exerciseID],parent:"LMS Programming Exercise",orderBy:"idx",onSuccess(s){b.value=!1,y.value=s.length},onError(s){var t;D.error(__(((t=s.messages)==null?void 0:t[0])||s)),console.error("Error loading testCases:",s)}}),I=()=>{h.update({filters:{parent:_.exerciseID,parenttype:"LMS Programming Exercise",parentfield:"test_cases"}}),h.reload(),y.value=h.data.length},z=()=>{m.value.title=pe(m.value.title.trim())};B(m,()=>{b.value=!0},{deep:!0}),B(h,()=>{h.data.length!==y.value&&(b.value=!0)});const A=()=>{m.value.test_cases=h.data.map((s,t)=>({input:s.input,expected_output:s.expected_output,idx:t+1}))},j=s=>{z(),A(),_.exerciseID=="new"?o(s):p(s)},o=s=>{var t;(t=d.value)==null||t.insert.submit({...m.value},{onSuccess(){var n;s(),b.value=!1,(n=d.value)==null||n.reload(),D.success(__("Programming Exercise created successfully"))},onError(n){var u;D.warning(__(((u=n.messages)==null?void 0:u[0])||n))}})},p=s=>{var t;(t=d.value)==null||t.setValue.submit({name:_.exerciseID,...m.value},{onSuccess(){var n;s(),b.value=!1,(n=d.value)==null||n.reload(),D.success(__("Programming Exercise updated successfully"))},onError(n){var u;D.warning(__(((u=n.messages)==null?void 0:u[0])||n))}})},k=W(()=>["Input","Expected Output"]),w=s=>{var t;_.exerciseID!="new"&&((t=d.value)==null||t.delete.submit(_.exerciseID,{onSuccess(){D.success(__("Programming Exercise deleted successfully")),s()},onError(n){var u;D.warning(__(((u=n.messages)==null?void 0:u[0])||n))}}))};return(s,t)=>{const n=te("router-link");return g(),U(e(de),{modelValue:T.value,"onUpdate:modelValue":t[4]||(t[4]=u=>T.value=u),options:{size:"4xl"}},{"body-title":l(()=>[r("div",Ae,[r("div",qe,v(_.exerciseID==="new"?s.__("Create Programming Exercise"):s.__("Edit Programming Exercise")),1),b.value?(g(),U(e(ge),{key:0,theme:"orange"},{default:l(()=>[V(v(s.__("Not Saved")),1)]),_:1})):N("",!0)])]),"body-content":l(()=>[r("div",Be,[r("div",Fe,[a(e(O),{modelValue:m.value.title,"onUpdate:modelValue":t[0]||(t[0]=u=>m.value.title=u),label:s.__("Title"),required:!0},null,8,["modelValue","label"]),a(e(O),{modelValue:m.value.language,"onUpdate:modelValue":t[1]||(t[1]=u=>m.value.language=u),label:s.__("Language"),type:"select",options:L,required:!0},null,8,["modelValue","label"]),a(Ne,{modelValue:e(h).data,"onUpdate:modelValue":t[2]||(t[2]=u=>e(h).data=u),label:s.__("Test Cases"),columns:k.value,required:!0,addable:!0,deletable:!0,editable:!0,placeholder:s.__("Add Test Case")},null,8,["modelValue","label","columns","placeholder"])]),r("div",null,[r("div",null,[r("div",Oe,[V(v(s.__("Problem Statement"))+" ",1),t[5]||(t[5]=r("span",{class:"text-ink-red-3"},"*",-1))]),a(e(_e),{content:m.value.problem_statement,onChange:t[3]||(t[3]=u=>m.value.problem_statement=u),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[21rem] overflow-y-auto"},null,8,["content"])])])])]),actions:l(({close:u})=>[r("div",Ye,[P.exerciseID!="new"?(g(),U(e($),{key:0,onClick:i=>w(u),variant:"outline",theme:"red"},{prefix:l(()=>[a(e(Q),{class:"size-4 stroke-1.5"})]),default:l(()=>[V(" "+v(s.__("Delete")),1)]),_:1},8,["onClick"])):N("",!0),a(n,{to:{name:"ProgrammingExerciseSubmission",params:{exerciseID:_.exerciseID,submissionID:"new"}}},{default:l(()=>[a(e($),null,{prefix:l(()=>[a(e(me),{class:"size-4 stroke-1.5"})]),default:l(()=>[V(" "+v(s.__("Test this Exercise")),1)]),_:1})]),_:1},8,["to"]),a(n,{to:{name:"ProgrammingExerciseSubmissions",query:{exercise:_.exerciseID}}},{default:l(()=>[a(e($),null,{prefix:l(()=>[a(e(se),{class:"size-4 stroke-1.5"})]),default:l(()=>[V(" "+v(s.__("Check Submission")),1)]),_:1})]),_:1},8,["to"]),a(e($),{variant:"solid",onClick:i=>j(u)},{default:l(()=>[V(v(s.__("Save")),1)]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])}}}),We={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ge={class:"space-x-2"},He={class:"p-5"},Ke={class:"flex items-center justify-between mb-5"},Xe={class:"text-lg font-semibold text-ink-gray-9"},Qe={class:"grid grid-cols-2 gap-5"},Ze={key:0},es={key:0,class:"text-sm text-ink-gray-5"},ss={key:1},ts={class:"flex gap-2"},as={key:2,class:"flex justify-center my-5"},ns=G({__name:"ProgrammingExercises",setup(P){const T=C(0),d=window.read_only_mode,{brand:b}=fe(),y=C(!1),m=C("new"),L=he("$user"),_=C(""),E=C(""),h=ke(),I=we(),{$dialog:z}=I==null?void 0:I.appContext.config.globalProperties;ve(()=>{A(),j()});const A=()=>{var i,c,S;!((i=L.data)!=null&&i.is_instructor)&&!((c=L.data)!=null&&c.is_moderator)&&!((S=L.data)!=null&&S.is_evaluator)&&h.push({name:"ProgrammingExerciseSubmissions"})},j=(i={})=>{X("frappe.client.get_count",{doctype:"LMS Programming Exercise",filters:i}).then(c=>{T.value=c}).catch(c=>{console.error("Error fetching exercise count:",c)})},o=ee({doctype:"LMS Programming Exercise",cache:["programmingExercises"],fields:["name","title","language","problem_statement","modified"],auto:!0,orderBy:"modified desc"}),p=()=>{let i=k();o.update({filters:i}),o.reload(),j(i)},k=()=>{let i={};return _.value&&(i.title=["like",`%${_.value}%`]),E.value&&E.value.trim()!==""&&(i.language=E.value),i},w=(i,c)=>{z({title:__("Confirm Your Action"),message:__("Deleting these exercises will permanently remove them from the system, along with all associated submissions. This action is irreversible. Are you sure you want to proceed?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(S){s(i,c),S()}}]})},s=(i,c)=>{Array.from(i).forEach(async S=>{X("lms.lms.api.delete_programming_exercise",{exercise:S}).then(()=>{D.success(__("Exercise deleted successfully")),p()}).catch(q=>{D.error(__(q.message||q)),console.error("Error deleting exercise:",q)})}),c()},t=[{label:" ",value:" "},{label:"Python",value:"Python"},{label:"JavaScript",value:"JavaScript"}],n=W(()=>[{label:__("Title"),key:"title",width:3},{label:__("Language"),key:"language",width:2,align:"left"},{label:__("Updated On"),key:"modified",width:1}]);xe(()=>({title:__("Programming Exercises"),icon:b.favicon}));const u=W(()=>[{label:__("Programming Exercises"),route:{name:"ProgrammingExercises"}}]);return(i,c)=>{var H;const S=te("router-link"),q=le;return g(),x(R,null,[r("header",We,[a(e(Te),{items:u.value},null,8,["items"]),r("div",Ge,[a(S,{to:{name:"ProgrammingExerciseSubmissions"}},{default:l(()=>[a(e($),null,{prefix:l(()=>[a(e(se),{class:"size-4 stroke-1.5"})]),default:l(()=>[V(" "+v(i.__("Check All Submissions")),1)]),_:1})]),_:1}),e(d)?N("",!0):(g(),U(e($),{key:0,variant:"solid",onClick:c[0]||(c[0]=()=>{m.value="new",y.value=!0})},{prefix:l(()=>[a(e(Z),{class:"h-4 w-4 stroke-1.5"})]),default:l(()=>[V(" "+v(i.__("Create")),1)]),_:1}))])]),r("div",He,[r("div",Ke,[r("div",Xe,v(i.__("{0} Exercises").format(T.value)),1),r("div",Qe,[a(e(O),{modelValue:_.value,"onUpdate:modelValue":c[1]||(c[1]=f=>_.value=f),placeholder:i.__("Search by Title"),onInput:p},null,8,["modelValue","placeholder"]),a(e(O),{modelValue:E.value,"onUpdate:modelValue":[c[2]||(c[2]=f=>E.value=f),p],type:"select",options:t,placeholder:i.__("Type")},null,8,["modelValue","placeholder"])])]),(H=e(o).data)!=null&&H.length?(g(),x("div",Ze,[a(e(ye),{columns:n.value,rows:e(o).data,"row-key":"name",options:{showTooltip:!1,selectable:!0,onRowClick:f=>{e(d)||(m.value=f.name,y.value=!0)}}},{default:l(()=>[a(e(Ce),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"}),a(e(Ee),null,{default:l(()=>[(g(!0),x(R,null,F(e(o).data,f=>(g(),U(e(Pe),{row:f,class:"hover:bg-surface-gray-1"},{default:l(({column:M,item:ae})=>[a(e(Ve),{item:f[M.key],align:M.align},{default:l(()=>[M.key=="modified"?(g(),x("div",es,v(e($e)(f[M.key]).format("MMM D, YYYY")),1)):(g(),x("div",ss,v(f[M.key]),1))]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),256))]),_:1}),a(e(De),null,{actions:l(({unselectAll:f,selections:M})=>[r("div",ts,[a(e($),{variant:"ghost",onClick:ae=>w(M,f)},{default:l(()=>[a(e(Se),{name:"trash-2",class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows","options"])])):(g(),U(q,{key:1,type:"Programming Exercises"})),e(o).data&&e(o).hasNextPage?(g(),x("div",as,[a(e($),{onClick:c[3]||(c[3]=f=>e(o).next())},{default:l(()=>[V(v(i.__("Load More")),1)]),_:1})])):N("",!0)]),a(Je,{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=f=>y.value=f),exerciseID:m.value,exercises:e(o),"onUpdate:exercises":c[5]||(c[5]=f=>be(o)?o.value=f:null)},null,8,["modelValue","exerciseID","exercises"])],64)}}});export{ns as default};
//# sourceMappingURL=ProgrammingExercises-CdrP73cI.js.map
