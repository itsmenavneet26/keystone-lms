import{x as J,B as n,y as X,W as ee,L as te,A as ae,o as i,a as k,b as m,e as c,u as s,l as w,w as g,k as D,t as V,Y as le,n as se,P as oe,p as F,Z as re,f as B,N as S,$ as ne,F as L,r as ie,E as $,i as N,q as ue,g as de}from"./index-H4DTv6Le.js";import{_ as ce}from"./BatchCard-Oxnebc7m.js";import{_ as ve}from"./EmptyState.vue_vue_type_script_setup_true_lang-C4EPuQXe.js";import{_ as me}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";import{T as pe}from"./TabButtons-BM55rf33.js";import"./DateRange-BPai7n_6.js";import"./CourseInstructors-CmNKc7w9.js";import"./UserAvatar-BNFxJ-NV.js";const fe={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},_e={class:"p-5 pb-10"},ge={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},he={class:"text-lg text-ink-gray-9 font-semibold"},be={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},ye={class:"grid grid-cols-2 gap-2"},we={class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40"},Be={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},xe={key:2,class:"flex justify-center mt-5"},Le={__name:"Batches",setup(ke){var M;const r=N("$user"),C=N("$dayjs"),{brand:T}=J(),U=n(0),j=n(20),p=n([]),f=n(null),_=n(""),h=n(!1),a=n({}),x=$(()=>{var e;return(e=r.data)==null?void 0:e.is_student}),u=n(x.value?"all":"upcoming"),b=n("start_date"),P=window.read_only_mode,Y=ue();X(()=>{E(),y(),p.value=[{label:"",value:null}]});const E=()=>{let e=new URLSearchParams(location.search);_.value=e.get("title")||"",f.value=e.get("category")||null,h.value=e.get("certification")||!1},d=ee({doctype:"LMS Batch",url:"lms.lms.utils.get_batches",cache:["batches",(M=r.data)==null?void 0:M.name],pageLength:j.value,start:U.value}),A=e=>{let t=e.map(l=>l.category);t=t.filter((l,v)=>t.indexOf(l)===v&&l),p.value.length<=t.length&&W(e)},y=()=>{R(),d.update({filters:a.value,orderBy:b.value}),d.reload().then(e=>{A(e)})},R=()=>{q(),z(),I(),O(),Q(),K()},q=()=>{f.value?a.value.category=f.value:delete a.value.category},z=()=>{_.value?a.value.title=["like",`%${_.value}%`]:delete a.value.title},I=()=>{h.value?a.value.certification=1:delete a.value.certification},O=()=>{b.value="start_date",r.data&&(u.value=="enrolled"&&x.value?(a.value.enrolled=1,delete a.value.start_date,delete a.value.published,b.value="start_date desc"):x.value?delete a.value.enrolled:(delete a.value.start_date,delete a.value.published,b.value="start_date desc",u.value=="upcoming"?(a.value.start_date=[">=",C().format("YYYY-MM-DD")],a.value.published=1,b.value="start_date"):u.value=="archived"?a.value.start_date=["<=",C().format("YYYY-MM-DD")]:u.value=="unpublished"&&(a.value.published=0)))},Q=()=>{(!r.data||x.value&&u.value!="enrolled")&&(a.value.start_date=[">=",C().format("YYYY-MM-DD")],a.value.published=1)},K=()=>{let e=new URLSearchParams(location.search),t={title:_.value,category:f.value,certification:h.value};Object.keys(t).forEach(l=>{t[l]?e.set(l,t[l]):e.delete(l)}),history.replaceState({},"",`${location.pathname}${e.size>0?`?${e.toString()}`:""}`)},W=e=>{e.forEach(t=>{t.category&&!p.value.find(l=>l.value===t.category)&&p.value.push({label:t.category,value:t.category})})};te(u,()=>{y()});const Z=$(()=>{var t,l,v;let e=[{label:__("All"),value:"all"}];return(t=r.data)!=null&&t.is_moderator||(l=r.data)!=null&&l.is_instructor||(v=r.data)!=null&&v.is_evaluator?(e.push({label:__("Upcoming"),value:"upcoming"}),e.push({label:__("Archived"),value:"archived"}),e.push({label:__("Unpublished"),value:"unpublished"})):r.data&&e.push({label:__("Enrolled"),value:"enrolled"}),e}),G=()=>{var e,t,l;return P?!1:!!((e=r.data)!=null&&e.is_moderator||(t=r.data)!=null&&t.is_instructor||(l=r.data)!=null&&l.is_evaluator)},H=$(()=>[{label:__("Batches"),route:{name:"Batches"}}]);return ae(()=>({title:__("Batches"),icon:T.favicon})),(e,t)=>{var v;const l=de("router-link");return i(),k(L,null,[m("header",fe,[c(s(me),{items:H.value},null,8,["items"]),G()?(i(),w(s(re),{key:0,options:[{label:e.__("New Batch"),icon:"users",onClick(){s(Y).push({name:"BatchForm",params:{batchName:"new"}})}},{label:e.__("Import Batch"),icon:"upload",onClick(){s(Y).push({name:"NewDataImport",params:{doctype:"LMS Batch"}})}}]},{default:g(({open:o})=>[c(s(F),{variant:"solid"},{prefix:g(()=>[c(s(oe),{class:"h-4 w-4 stroke-1.5"})]),suffix:g(()=>[c(s(le),{class:se(["w-4 h-4 stroke-1.5 ml-1 transform transition-transform",o?"rotate-180":""])},null,8,["class"])]),default:g(()=>[D(" "+V(e.__("Create"))+" ",1)]),_:2},1024)]),_:1},8,["options"])):B("",!0)]),m("div",_e,[m("div",ge,[m("div",he,V(e.__("All Batches")),1),m("div",be,[s(r).data?(i(),w(s(pe),{key:0,buttons:Z.value,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),class:"w-fit"},null,8,["buttons","modelValue"])):B("",!0),m("div",ye,[c(s(S),{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),placeholder:e.__("Search by Title"),type:"text",class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40",onInput:t[2]||(t[2]=o=>y())},null,8,["modelValue","placeholder"]),m("div",we,[p.value.length?(i(),w(s(ne),{key:0,modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=o=>f.value=o),t[4]||(t[4]=o=>y())],options:p.value,placeholder:e.__("Category")},null,8,["modelValue","options","placeholder"])):B("",!0)])]),c(s(S),{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=o=>h.value=o),label:e.__("Certification"),type:"checkbox",onChange:t[6]||(t[6]=o=>y())},null,8,["modelValue","label"])])]),(v=s(d).data)!=null&&v.length?(i(),k("div",Be,[(i(!0),k(L,null,ie(s(d).data,o=>(i(),w(l,{to:{name:"BatchDetail",params:{batchName:o.name}}},{default:g(()=>[c(ce,{batch:o},null,8,["batch"])]),_:2},1032,["to"]))),256))])):s(d).list.loading?B("",!0):(i(),w(ve,{key:1,type:"Batches"})),!s(d).list.loading&&s(d).hasNextPage?(i(),k("div",xe,[c(s(F),{onClick:t[7]||(t[7]=o=>s(d).next())},{default:g(()=>[D(V(e.__("Load More")),1)]),_:1})])):B("",!0)])],64)}}};export{Le as default};
//# sourceMappingURL=Batches-D5W1CcxZ.js.map
