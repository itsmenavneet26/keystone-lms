{"version":3,"file":"Search-B8qCjiNU.js","sources":["../../../../frontend/src/pages/Search/Search.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"[{ label: __('Search') }]\" />\n\t</header>\n\t<div class=\"w-4/6 mx-auto py-5\">\n\t\t<div class=\"px-2.5\">\n\t\t\t<TextInput\n\t\t\t\tref=\"searchInput\"\n\t\t\t\tclass=\"flex-1\"\n\t\t\t\tplaceholder=\"Search for a keyword or phrase and press enter\"\n\t\t\t\tautocomplete=\"off\"\n\t\t\t\t:model-value=\"query\"\n\t\t\t\t@update:model-value=\"updateQuery\"\n\t\t\t\t@keydown.enter=\"() => submit()\"\n\t\t\t>\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<Search class=\"w-4 text-ink-gray-5\" />\n\t\t\t\t</template>\n\t\t\t\t<template #suffix>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if=\"query\"\n\t\t\t\t\t\t\t@click=\"clearSearch\"\n\t\t\t\t\t\t\tclass=\"p-1 size-6 grid place-content-center focus:outline-none focus:ring focus:ring-outline-gray-3 rounded\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<X class=\"w-4 text-ink-gray-7\" />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</TextInput>\n\t\t\t<div\n\t\t\t\tv-if=\"query && searchResults.length\"\n\t\t\t\tclass=\"text-sm text-ink-gray-5 mt-2\"\n\t\t\t>\n\t\t\t\t{{ searchResults.length }}\n\t\t\t\t{{ searchResults.length === 1 ? __('match') : __('matches') }}\n\t\t\t</div>\n\t\t\t<div v-else-if=\"queryChanged\" class=\"text-sm text-ink-gray-5 mt-2\">\n\t\t\t\t{{ __('Press enter to search') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else-if=\"query && !searchResults.length\"\n\t\t\t\tclass=\"text-sm text-ink-gray-5 mt-2\"\n\t\t\t>\n\t\t\t\t{{ __('No results found') }}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"mt-5\">\n\t\t\t<div v-if=\"searchResults.length\" class=\"\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(result, index) in searchResults\"\n\t\t\t\t\t@click=\"navigate(result)\"\n\t\t\t\t\tclass=\"rounded-md cursor-pointer hover:bg-surface-gray-2 px-2\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex space-x-2 py-3\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'border-b': index !== searchResults.length - 1,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip :text=\"result.author_info.full_name\">\n\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t:label=\"result.author_info.full_name\"\n\t\t\t\t\t\t\t\t:image=\"result.author_info.user_image\"\n\t\t\t\t\t\t\t\tsize=\"md\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t<div class=\"space-y-1 w-full\">\n\t\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"font-medium text-ink-gray-9\"\n\t\t\t\t\t\t\t\t\tv-html=\"result.title\"\n\t\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm text-ink-gray-5 ml-2\">\n\t\t\t\t\t\t\t\t\t{{ getDocTypeTitle(result.doctype) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if=\"\n\t\t\t\t\t\t\t\t\t\tresult.published_on ||\n\t\t\t\t\t\t\t\t\t\tresult.start_date ||\n\t\t\t\t\t\t\t\t\t\tresult.creation ||\n\t\t\t\t\t\t\t\t\t\tresult.modified\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\tclass=\"ml-auto text-sm text-ink-gray-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tdayjs(\n\t\t\t\t\t\t\t\t\t\t\tresult.published_on ||\n\t\t\t\t\t\t\t\t\t\t\t\tresult.start_date ||\n\t\t\t\t\t\t\t\t\t\t\t\tresult.creation ||\n\t\t\t\t\t\t\t\t\t\t\t\tresult.modified\n\t\t\t\t\t\t\t\t\t\t).format('DD MMM YYYY')\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"leading-5 text-ink-gray-7\"\n\t\t\t\t\t\t\t\tv-html=\"result.content\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script setup lang=\"ts\">\nimport {\n\tAvatar,\n\tBreadcrumbs,\n\tcreateResource,\n\tdebounce,\n\tTextInput,\n\tTooltip,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { inject, onMounted, ref, watch } from 'vue'\nimport { Search, X } from 'lucide-vue-next'\nimport { sessionStore } from '@/stores/session'\nimport { useRouter, useRoute } from 'vue-router'\n\nconst query = ref('')\nconst searchInput = ref<HTMLInputElement | null>(null)\nconst searchResults = ref<Array<any>>([])\nconst { brand } = sessionStore()\nconst router = useRouter()\nconst route = useRoute()\nconst queryChanged = ref(false)\nconst dayjs = inject<any>('$dayjs')\n\nonMounted(() => {\n\tif (router.currentRoute.value.query.q) {\n\t\tquery.value = router.currentRoute.value.query.q as string\n\t\tsubmit()\n\t}\n})\n\nconst updateQuery = (value: string) => {\n\tquery.value = value\n\trouter.replace({ query: value ? { q: value } : {} })\n}\n\nconst submit = debounce(() => {\n\tif (query.value.length > 2) {\n\t\tsearch.reload()\n\t}\n}, 500)\n\nconst search = createResource({\n\turl: 'lms.command_palette.search_sqlite',\n\tmakeParams: () => ({\n\t\tquery: query.value,\n\t}),\n\tonSuccess() {\n\t\tgenerateSearchResults()\n\t},\n})\n\nconst generateSearchResults = () => {\n\tsearchResults.value = []\n\tif (search.data) {\n\t\tqueryChanged.value = false\n\t\tsearch.data.forEach((group: any) => {\n\t\t\tgroup.items.forEach((item: any) => {\n\t\t\t\tsearchResults.value.push(item)\n\t\t\t})\n\t\t})\n\t\tsortResults()\n\t}\n}\n\nconst sortResults = () => {\n\tsearchResults.value.sort((a, b) => {\n\t\tconst dateA = new Date(\n\t\t\ta.published_on || a.start_date || a.creation || a.modified\n\t\t).getTime()\n\t\tconst dateB = new Date(\n\t\t\tb.published_on || b.start_date || b.creation || b.modified\n\t\t).getTime()\n\t\treturn dateB - dateA\n\t})\n}\n\nconst navigate = (result: any) => {\n\tif (result.doctype == 'LMS Course') {\n\t\trouter.push({\n\t\t\tname: 'CourseDetail',\n\t\t\tparams: {\n\t\t\t\tcourseName: result.name,\n\t\t\t},\n\t\t})\n\t} else if (result.doctype == 'LMS Batch') {\n\t\trouter.push({\n\t\t\tname: 'BatchDetail',\n\t\t\tparams: {\n\t\t\t\tbatchName: result.name,\n\t\t\t},\n\t\t})\n\t} else if (result.doctype == 'Job Opportunity') {\n\t\trouter.push({\n\t\t\tname: 'JobDetail',\n\t\t\tparams: {\n\t\t\t\tjob: result.name,\n\t\t\t},\n\t\t})\n\t}\n}\n\nwatch(query, () => {\n\tif (query.value && query.value != search.params?.query) {\n\t\tqueryChanged.value = true\n\t} else if (!query.value) {\n\t\tqueryChanged.value = false\n\t\tsearchResults.value = []\n\t}\n})\n\nwatch(\n\t() => route.query.q,\n\t(newQ) => {\n\t\tif (newQ && newQ !== query.value) {\n\t\t\tquery.value = newQ as string\n\t\t\tsubmit()\n\t\t}\n\t}\n)\n\nconst getDocTypeTitle = (doctype: string) => {\n\tif (doctype === 'LMS Course') {\n\t\treturn __('Course')\n\t} else if (doctype === 'LMS Batch') {\n\t\treturn __('Batch')\n\t} else if (doctype === 'Job Opportunity') {\n\t\treturn __('Job')\n\t} else {\n\t\treturn doctype\n\t}\n}\n\nconst clearSearch = () => {\n\tquery.value = ''\n\tupdateQuery('')\n}\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Search'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["query","ref","searchInput","searchResults","brand","sessionStore","router","useRouter","route","useRoute","queryChanged","dayjs","inject","onMounted","submit","updateQuery","value","debounce","search","createResource","generateSearchResults","group","item","sortResults","a","b","dateA","navigate","result","watch","_a","newQ","getDocTypeTitle","doctype","clearSearch","usePageMeta","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","__","_hoisted_2","_hoisted_3","TextInput","Search","_hoisted_4","_createElementBlock","X","_openBlock","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_Fragment","_renderList","index","$event","Tooltip","Avatar","_hoisted_11","_hoisted_12","_hoisted_14","_hoisted_15"],"mappings":"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"}