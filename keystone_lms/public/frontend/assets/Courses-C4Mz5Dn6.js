import{d as re,s as ue,H as ne,J as ie,y as R,K as de,L as Y,o as f,l as h,u as o,D as ce,w as _,b as m,e as d,k as M,t as k,p as F,N as U,O as q,Q as me,R as pe,S as ve,v as fe,B as v,q as z,i as P,T as B,U as ge,x as _e,W as be,z as j,A as ye,a as S,X as Ce,Y as he,n as we,P as Ve,Z as $e,f as $,$ as ke,F as I,r as xe,E as O,g as Se}from"./index-H4DTv6Le.js";import{_ as Me}from"./CourseCard-BbwRDLnH.js";import{_ as Ue}from"./EmptyState.vue_vue_type_script_setup_true_lang-C4EPuQXe.js";import{_ as Le}from"./MultiSelect-BXXjw7iZ.js";import{_ as De}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CKfttt8M.js";import{T as Ne}from"./TabButtons-BM55rf33.js";import"./CourseInstructors-CmNKc7w9.js";import"./UserAvatar-BNFxJ-NV.js";const Te={class:"text-base"},Fe={class:"grid grid-cols-2 gap-5 border-b mb-5"},Pe={class:"space-y-4"},Ee={class:""},qe={class:"mb-1.5 text-sm text-ink-gray-5"},Be={class:"text-right"},je=re({__name:"NewCourseModal",props:fe({courses:{}},{modelValue:{type:Boolean,required:!0,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(L){const n=ue(L,"modelValue"),D=z(),{capture:x}=ne(),{updateOnboardingStep:N}=ie("learning"),C=P("$user"),b=L,u=v({title:"",short_introduction:"",description:"",instructors:[],category:null,image:null}),y=(l=()=>{})=>{b.courses.insert.submit({...u.value,instructors:u.value.instructors.map(a=>({instructor:a}))},{onSuccess(a){var r;B.success(__("Course created successfully")),l(),x("course_created"),D.push({name:"CourseDetail",params:{courseName:a.name},hash:"#settings"}),(r=C.data)!=null&&r.is_system_manager&&N("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",a.name)})},onError(a){var r;B.error(ge((r=a.messages)==null?void 0:r[0])),console.error(a)}})},s=l=>{l.key==="s"&&(l.ctrlKey||l.metaKey)&&l.target&&l.target instanceof HTMLElement&&!l.target.classList.contains("ProseMirror")&&(y(),l.preventDefault())};return R(()=>{window.addEventListener("keydown",s)}),de(()=>{window.removeEventListener("keydown",s)}),Y(n,()=>{n.value&&x("course_form_opened")}),(l,a)=>(f(),h(o(ce),{modelValue:n.value,"onUpdate:modelValue":a[7]||(a[7]=r=>n.value=r),options:{title:l.__("Create Course"),size:"3xl"}},{"body-content":_(()=>[m("div",Te,[m("div",Fe,[d(o(U),{modelValue:u.value.title,"onUpdate:modelValue":a[0]||(a[0]=r=>u.value.title=r),label:l.__("Title"),required:!0},null,8,["modelValue","label"]),d(o(me),{doctype:"LMS Category",modelValue:u.value.category,"onUpdate:modelValue":a[1]||(a[1]=r=>u.value.category=r),label:l.__("Category"),allowCreate:!0,onCreate:a[2]||(a[2]=()=>{o(q)("Categories"),n.value=!1})},null,8,["modelValue","label"]),d(Le,{modelValue:u.value.instructors,"onUpdate:modelValue":a[3]||(a[3]=r=>u.value.instructors=r),doctype:"User",label:l.__("Instructors"),filters:{ignore_user_type:1},onCreate:r=>o(q)("Members",r),required:!0},null,8,["modelValue","label","onCreate"]),d(pe,{modelValue:u.value.image,"onUpdate:modelValue":a[4]||(a[4]=r=>u.value.image=r),label:l.__("Course Image"),required:!1},null,8,["modelValue","label"])]),m("div",Pe,[d(o(U),{modelValue:u.value.short_introduction,"onUpdate:modelValue":a[5]||(a[5]=r=>u.value.short_introduction=r),label:l.__("Short Introduction"),type:"textarea",required:!0,rows:4},null,8,["modelValue","label"]),m("div",Ee,[m("div",qe,[M(k(l.__("Course Description"))+" ",1),a[8]||(a[8]=m("span",{class:"text-ink-red-3"},"*",-1))]),d(o(ve),{content:u.value.description,onChange:a[6]||(a[6]=r=>u.value.description=r),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x border-outline-gray-modals bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[10rem]"},null,8,["content"])])])])]),actions:_(({close:r})=>[m("div",Be,[d(o(F),{variant:"solid",onClick:T=>y(r)},{default:_(()=>[M(k(l.__("Create")),1)]),_:1},8,["onClick"])])]),_:1},8,["modelValue","options"]))}}),Ie={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Oe={class:"p-5 pb-10"},Re={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},Ye={class:"text-lg text-ink-gray-9 font-semibold"},ze={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},Ke={class:"grid grid-cols-2 gap-2"},Qe={class:"w-full lg:min-w-0 lg:w-32 xl:w-40"},Ae={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-8"},He={key:2,class:"flex justify-center mt-5"},at={__name:"Courses",setup(L){var E;const n=P("$user"),D=P("$dayjs"),x=v(0),N=v(30),C=v([{label:"",value:null}]),b=v(null),u=v(""),y=v(!1),s=v({}),l=v("live"),{brand:a}=_e(),r=v(0),T=z(),w=v(!1);R(()=>{K(),V(),J()});const K=()=>{let e=new URLSearchParams(location.search);u.value=e.get("title")||"",b.value=e.get("category")||null,y.value=e.get("certification")||!1,e.get("newCourse")=="1"&&(w.value=!0)},g=be({doctype:"LMS Course",url:"lms.lms.utils.get_courses",cache:["courses",(E=n.data)==null?void 0:E.name],pageLength:N.value,start:x.value}),Q=e=>{let t=e.map(c=>c.category);t=t.filter((c,p)=>t.indexOf(c)===p&&c),C.value.length<=t.length&&ae(e)},A=async()=>await j("frappe.client.get_single_value",{doctype:"LMS Settings",field:"persona_captured"}),H=async()=>{var e,t;if((e=n.data)!=null&&e.is_system_manager&&!((t=n.data)!=null&&t.developer_mode)){if(await A())return;r.value||T.push({name:"PersonaForm"})}},J=()=>{n.data&&n.data.is_moderator&&j("frappe.client.get_count",{doctype:"LMS Course"}).then(e=>{r.value=e,H()})},V=()=>{W(),g.update({filters:s.value}),g.reload().then(e=>{Q(e)})},W=()=>{X(),Z(),G(),ee(),te(),le()},X=()=>{b.value?s.value.category=b.value:delete s.value.category},Z=()=>{u.value?s.value.title=["like",`%${u.value}%`]:delete s.value.title},G=()=>{y.value?s.value.certification=1:delete s.value.certification},ee=()=>{var e;delete s.value.live,delete s.value.created,delete s.value.published_on,delete s.value.upcoming,l.value=="enrolled"&&((e=n.data)!=null&&e.is_student)?(s.value.enrolled=1,delete s.value.published):(delete s.value.published,delete s.value.enrolled,l.value=="live"?(s.value.published=1,s.value.upcoming=0,s.value.live=1):l.value=="upcoming"?s.value.upcoming=1:l.value=="new"?(s.value.published=1,s.value.published_on=[">=",D().add(-3,"month").format("YYYY-MM-DD")]):l.value=="created"?s.value.created=1:l.value=="unpublished"&&(s.value.published=0))},te=()=>{var e;(!n.data||(e=n.data)!=null&&e.is_student&&l.value!="enrolled")&&(s.value.published=1)},le=()=>{let e=new URLSearchParams(location.search),t={title:u.value,category:b.value,certification:y.value};Object.keys(t).forEach(p=>{t[p]?e.set(p,t[p]):e.delete(p)});let c="";e.toString()&&(c=`?${e.toString()}`),history.replaceState({},"",`${location.pathname}${c}`)},ae=e=>{e.forEach(t=>{t.category&&!C.value.find(c=>c.value===t.category)&&C.value.push({label:t.category,value:t.category})})};Y(l,()=>{V()});const se=O(()=>{var t,c,p;let e=[{label:__("Live"),value:"live"},{label:__("New"),value:"new"},{label:__("Upcoming"),value:"upcoming"}];return(t=n.data)!=null&&t.is_moderator||(c=n.data)!=null&&c.is_instructor||(p=n.data)!=null&&p.is_evaluator?(e.push({label:__("Created"),value:"created"}),e.push({label:__("Unpublished"),value:"unpublished"})):n.data&&e.push({label:__("Enrolled"),value:"enrolled"}),e}),oe=O(()=>[{label:__("Courses"),route:{name:"Courses"}}]);return ye(()=>({title:__("Courses"),icon:a.favicon})),(e,t)=>{var p;const c=Se("router-link");return f(),S(I,null,[m("header",Ie,[d(o(De),{items:oe.value},null,8,["items"]),o(Ce)()?(f(),h(o($e),{key:0,placement:"right",side:"bottom",options:[{label:e.__("New Course"),icon:"book-open",onClick(){w.value=!0}},{label:e.__("Import Course"),icon:"upload",onClick(){o(T).push({name:"NewDataImport",params:{doctype:"LMS Course"}})}}]},{default:_(({open:i})=>[d(o(F),{variant:"solid"},{prefix:_(()=>[d(o(Ve),{class:"h-4 w-4 stroke-1.5"})]),suffix:_(()=>[d(o(he),{class:we(["w-4 h-4 stroke-1.5 ml-1 transform transition-transform",i?"rotate-180":""])},null,8,["class"])]),default:_(()=>[M(" "+k(e.__("Create"))+" ",1)]),_:2},1024)]),_:1},8,["options"])):$("",!0)]),m("div",Oe,[m("div",Re,[m("div",Ye,k(e.__("All Courses")),1),m("div",ze,[d(o(Ne),{buttons:se.value,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=i=>l.value=i),class:"w-fit"},null,8,["buttons","modelValue"]),m("div",Ke,[d(o(U),{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=i=>u.value=i),placeholder:e.__("Search by Title"),type:"text",class:"w-full lg:min-w-0 lg:w-32 xl:w-40",onInput:t[2]||(t[2]=i=>V())},null,8,["modelValue","placeholder"]),m("div",Qe,[C.value.length?(f(),h(o(ke),{key:0,modelValue:b.value,"onUpdate:modelValue":[t[3]||(t[3]=i=>b.value=i),t[4]||(t[4]=i=>V())],options:C.value,placeholder:e.__("Category")},null,8,["modelValue","options","placeholder"])):$("",!0)])]),d(o(U),{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=i=>y.value=i),label:e.__("Certification"),type:"checkbox",onChange:t[6]||(t[6]=i=>V())},null,8,["modelValue","label"])])]),(p=o(g).data)!=null&&p.length?(f(),S("div",Ae,[(f(!0),S(I,null,xe(o(g).data,i=>(f(),h(c,{to:{name:"CourseDetail",params:{courseName:i.name}}},{default:_(()=>[d(Me,{course:i},null,8,["course"])]),_:2},1032,["to"]))),256))])):o(g).list.loading?$("",!0):(f(),h(Ue,{key:1,type:"Courses"})),!o(g).list.loading&&o(g).hasNextPage?(f(),S("div",He,[d(o(F),{onClick:t[7]||(t[7]=i=>o(g).next())},{default:_(()=>[M(k(e.__("Load More")),1)]),_:1})])):$("",!0)]),w.value?(f(),h(je,{key:0,modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=i=>w.value=i),courses:o(g)},null,8,["modelValue","courses"])):$("",!0)],64)}}};export{at as default};
//# sourceMappingURL=Courses-C4Mz5Dn6.js.map
